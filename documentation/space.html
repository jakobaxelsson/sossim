<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>space API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#Node">Node</a>
            </li>
            <li>
                    <a class="variable" href="#Edge">Edge</a>
            </li>
            <li>
                    <a class="variable" href="#Direction">Direction</a>
            </li>
            <li>
                    <a class="class" href="#RoadGridGraph">RoadGridGraph</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RoadGridGraph.__init__">RoadGridGraph</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadGridGraph.width">width</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadGridGraph.height">height</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.grid_neighbors">grid_neighbors</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.add_road">add_road</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.add_roads">add_roads</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.add_destination">add_destination</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.has_road_to">has_road_to</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.is_road">is_road</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadGridGraph.road_degree">road_degree</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#subnode">subnode</a>
            </li>
            <li>
                    <a class="class" href="#RoadNetworkGrid">RoadNetworkGrid</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RoadNetworkGrid.__init__">RoadNetworkGrid</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.width">width</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.height">height</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.road_density">road_density</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.destination_density">destination_density</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.charging_point_density">charging_point_density</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.coarse_network">coarse_network</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoadNetworkGrid.road_network">road_network</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.subgraph">subgraph</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.generate_roads">generate_roads</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.priority_nodes">priority_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.road_nodes">road_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.destination_nodes">destination_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.road_edges">road_edges</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.roads_from">roads_from</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.roads_to">roads_to</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.is_destination">is_destination</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.is_charging_point">is_charging_point</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.edge_direction">edge_direction</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.shortest_path">shortest_path</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.path_to_nearest">path_to_nearest</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.has_road_to">has_road_to</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.is_road">is_road</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.grid_neighbors">grid_neighbors</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.place_agent">place_agent</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.get_neighborhood">get_neighborhood</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.get_neighbors">get_neighbors</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.move_agent">move_agent</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.remove_agent">remove_agent</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.is_cell_empty">is_cell_empty</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.get_cell_list_contents">get_cell_list_contents</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.get_all_cell_contents">get_all_cell_contents</a>
                        </li>
                        <li>
                                <a class="function" href="#RoadNetworkGrid.iter_cell_list_contents">iter_cell_list_contents</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
space    </h1>

                        <div class="docstring"><p>Provides spaces for the SoSSim system-of-systems simulator.
The space is a grid rendered as a bidirectional graph, with nodes being grid cells and with edges between all adjacent grid cells.
Attributes can be set on nodes and edges to represent roads, destinations, etc.</p>

<p>Partial UML class diagram:</p>

<pre class="mermaid-pre"><div class="mermaid">classDiagram
    `nx.DiGraph` &lt;|-- RoadGridGraph
    RoadGridGraph: grid_neighbors(node, ...)
    RoadGridGraph: add_road(source, sink, ...)
    RoadGridGraph: add_roads(node, directions)
    RoadGridGraph: add_destination(node1, node2, charging_point)
    RoadGridGraph: has_road_to(source, direction)
    RoadGridGraph: is_road(node1, [node2])
    RoadGridGraph: road_degree(node)

    `<a href="core.html#Space">core.Space</a>` &lt;|-- RoadNetworkGrid
    RoadNetworkGrid --&gt; RoadGridGraph: coarse_network
    RoadNetworkGrid --&gt; RoadGridGraph: road_network
    RoadNetworkGrid --&gt; `<a href="core.html#Model">core.Model</a>`: model
    RoadNetworkGrid: subgraph(nodes)
    RoadNetworkGrid: generate_roads()
    RoadNetworkGrid: priority_nodes()
</div></pre>
</div>

                        <input id="mod-space-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-space-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Provides spaces for the SoSSim system-of-systems simulator.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">The space is a grid rendered as a bidirectional graph, with nodes being grid cells and with edges between all adjacent grid cells.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">Attributes can be set on nodes and edges to represent roads, destinations, etc.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">Partial UML class diagram:</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">```mermaid</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">classDiagram</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">    `nx.DiGraph` &lt;|-- RoadGridGraph</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">    RoadGridGraph: grid_neighbors(node, ...)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">    RoadGridGraph: add_road(source, sink, ...)</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    RoadGridGraph: add_roads(node, directions)</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    RoadGridGraph: add_destination(node1, node2, charging_point)</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    RoadGridGraph: has_road_to(source, direction)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    RoadGridGraph: is_road(node1, [node2])</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    RoadGridGraph: road_degree(node)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    `core.Space` &lt;|-- RoadNetworkGrid</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    RoadNetworkGrid --&gt; RoadGridGraph: coarse_network</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    RoadNetworkGrid --&gt; RoadGridGraph: road_network</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    RoadNetworkGrid --&gt; `core.Model`: model</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    RoadNetworkGrid: subgraph(nodes)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    RoadNetworkGrid: generate_roads()</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    RoadNetworkGrid: priority_nodes()</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">```</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">import</span> <span class="nn">copy</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">NewType</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Self</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="kn">from</span> <span class="nn">configuration</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">configurable</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="kn">import</span> <span class="nn">core</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="c1"># Type abbreviations for nodes, edges and directions.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="n">Node</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="n">Edge</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s2">&quot;Edge&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">Node</span><span class="p">])</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="n">Direction</span> <span class="o">=</span> <span class="nb">int</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="k">class</span> <span class="nc">RoadGridGraph</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">):</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    A directed graph representing a 2D grid where the edges are labelled by direction in degrees.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    Roads are represented by having the node and edge attribute &quot;road&quot; set to True.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    Destinations are represented by having the node attribute &quot;destination&quot; set to True.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    Some destinations can also have charging points.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        Creates the grid graph.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        </span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Args:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">            width (int, optional): the width of the grid. Defaults to 0.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">            height (int, optional): the height of the grid. Defaults to 0.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Returns:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">            nx.DiGraph: the resulting graph.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">grid_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        Returns a list of all grid neighbors of a node. If diagonal is False, diagonal neighbors are not included.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        Args:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">            diagonal (bool, optional): if True, diagonal neighbors are included. Defaults to False.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">            center (bool, optional): if True, the given node, which is at the center of the set, is included in the result. Defaults to False.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            dist (int, optional): if different from 1, include all nodes at this distance. Defaults to 1.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        Returns:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">            list[Node]: a list of grid neighbors.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ax</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ax</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)):</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ay</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ay</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)):</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>                <span class="k">if</span> <span class="n">diagonal</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="n">ay</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">center</span><span class="p">:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">add_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        Adds a road from the source node to the sink node.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Args:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            source (Node): source node.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            sink (Node): sink node.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            bidirectional (bool, optional): if True, the road in opposite direction is also added. Defaults to False.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="c1"># Set the default attribute values of nodes and edges</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="c1"># TODO: Do this only if the attributes have not yet been defined</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">]:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;charging_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">bidirectional</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">sink</span><span class="p">][</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">sink</span><span class="p">][</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">add_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">directions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Direction</span><span class="p">]):</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        Adds a sequence of roads to the network, starting in the provided node and going in the provided directions.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        Args:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">            node (Node): the start node.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">            directions (list[Direction]): a list containing directions in degrees.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">directions</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">90</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> <span class="mi">180</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">270</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="p">}</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="n">next_node</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">next_node</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="n">node</span> <span class="o">=</span> <span class="n">next_node</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">add_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">charging_point</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Adds a destination node, as a neighbor of the given node.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        Roads are added to and from the destination from the node.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        The destination node is indicated as such using a node attribute.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        </span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        Args:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            node1 (Node): the node to be connected to the destination.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">            node2 (Node): the destination.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            charging_point (bool, optional): if True, the destination is a charging point. Defaults to False.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node2</span><span class="p">][</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">charging_point</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node2</span><span class="p">][</span><span class="s2">&quot;charging_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>    <span class="k">def</span> <span class="nf">has_road_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        Returns True if and only if the graph has a road from the given node in the given direction.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">            direction (Direction): the direction in degrees.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        Returns:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">            bool: _description_</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">direction</span> <span class="k">for</span> <span class="n">sink</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">))</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">is_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Checks if a node or an edge is a road. If two nodes are given, it checks the edge, otherwise the node.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Args:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            node1 (Node): a node.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">            node2 (Node, optional): a second node, if checking an edge. Defaults to None.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        Returns:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            bool: True if the node or edge is a road.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">node2</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">node1</span><span class="p">][</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">road_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        Returns the number of outgoing roads from a node.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">            int: the number of outgoing roads.</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">sink</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span><span class="p">])</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="k">def</span> <span class="nf">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">    Returns the detailed network subnode (i, j) of a coarse network node.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="k">return</span> <span class="n">Node</span><span class="p">((</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">))</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="nd">@configurable</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="k">class</span> <span class="nc">RoadNetworkGrid</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Space</span><span class="p">):</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">    An agent space consisting of a road network which is placed on a grid.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">    The road network is a networkx graph, where node names are tuples (x, y) referring to grid positions.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">    Some nodes in the road networks can be destinations, where places of interest can be placed.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="n">width</span><span class="p">:</span>                  <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span>   <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;number of grid cells in x dimension&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">10</span>  
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>    <span class="n">height</span><span class="p">:</span>                 <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span>   <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;number of grid cells in y dimension&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">10</span>   
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="n">road_density</span><span class="p">:</span>           <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;the proportion of the grid to be covered by roads&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="n">destination_density</span><span class="p">:</span>    <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;probability of generating a destination in a position where it is possible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span> 
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="n">charging_point_density</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;probability of a destination having a charging point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Creates a grid of size (width, height), and adds a road network to it.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        Args:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">            configuration (Configuration): the configuration of parameters from which the road network is generated.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">            model (core.Model): the model of which this space is to be a part.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="c1"># Setup parameters and superclass</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="n">configuration</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="c1"># Generate roads and destinations</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_roads</span><span class="p">()</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        Creates a copy of the space, where the road network is a subgraph of the complete network, only containing the given nodes.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        Args:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">            nodes (list[Node]): the nodes to be included in the subgraph.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        Returns:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">            Self: the subgraph space.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">subgraph_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">filter_node</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">generate_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        Generates the road network. This is a two step process.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        First, a coarse undirected network is generated, where each node corresponds to a grid cell.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        Heustistics are used to try to spread this network over the grid and have a balance between dense and sprawling roads.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        Second, this network is expanded into a directed graph, containing separate roadways and roundabouts.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        This is achieved by dividing each coarse network node / grid cell into 4 x 4 subnodes.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        These are connected so that traffic in all directions become possible.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        In the resulting directed network, each node has either one or two outgoing edges.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        The network keeps track of what agents are currently in a node.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">cnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="c1"># Step 1. Create a connected graph whose nodes are a subset of the grid cells.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="n">start_node</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">edge_candidates</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">start_node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">start_node</span><span class="p">)</span> <span class="p">}</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="c1"># The number of nodes is determined by the road_density parameter.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">remaining_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_density</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="k">while</span> <span class="n">remaining_nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="c1"># Pick an edge to add, removing it from the candidates and adding it to the graph</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_candidates</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">edge_candidates</span><span class="o">.</span><span class="n">items</span><span class="p">()])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="c1"># If the sink of the new edge is new in the graph, add edges to its neighbors as new edge candidates</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">sink</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                <span class="n">new_edge_candidates</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">sink</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span> <span class="p">}</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>                <span class="n">edge_candidates</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_edge_candidates</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="c1"># Add the new edge (and implicitly its nodes), and remove the edge as a candidate.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">cnw</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">remaining_nodes</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="k">del</span> <span class="n">edge_candidates</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)]</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="c1"># Update the edge preferences for all connections to neighbours of source and sink</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">]:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                    <span class="n">edge_candidates</span><span class="p">[(</span><span class="n">node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="c1"># Step 2. Add lanes and roundabouts.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="c1"># Create a new graph, this time directed. Each node in the coarse graph maps to 4 x 4 nodes in the new graph.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">rnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="c1"># Main directions as letters to improve readability.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="n">N</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="c1"># Add internal connections between coarse node in detailed graph.</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cnw</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="c1"># Add connections for roundabouts and through roads</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cnw</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>                <span class="c1"># Dead ends need to make it possible to turn around, which requires adding three out of four edges.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">])</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">])</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">])</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">])</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                <span class="c1"># Through roads</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">])</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">])</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">])</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">])</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">])</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">])</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="c1"># # Three and four way crossings require roundabouts, so all four edges are added.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">])</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="c1"># Add one destination to all road nodes that have a free grid neighbor. </span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rnw</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="n">rnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="k">for</span> <span class="n">destination</span> <span class="ow">in</span> <span class="n">rnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span> 
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_density</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                            <span class="n">charging_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">charging_point_density</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                            <span class="n">rnw</span><span class="o">.</span><span class="n">add_destination</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">charging_point</span> <span class="o">=</span> <span class="n">charging_point</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                            <span class="k">break</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="k">def</span> <span class="nf">_edge_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="n">Edge</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        Provides a heuristic for adding edges to the coarse network during generation.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">        It assigns a random preference to the provided edge depending on where it is on the grid and the connecting nodes previous edges.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">        Args:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">            edge (Edge): the edge.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">        Returns:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">            float: a number indicating how preferred this edge is.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="c1"># Returns a numerical value indicating how preferred this edge is (higher means more likely to be selected)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="n">cnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="c1"># Count number of existing edges for the source and sink of the selected edge</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="n">nb_source_edges</span> <span class="o">=</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cnw</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="n">nb_sink_edges</span> <span class="o">=</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cnw</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="c1"># Count distance of sink from center of world normalized with respect to the size of the world</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="n">dist_x</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="n">dist_y</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="n">norm_dist</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist_x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">dist_y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="c1"># Prefer adding edges away from the center and adding new nodes (a small epsilon is added to ensure that weights &gt; 0)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="k">return</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">norm_dist</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb_source_edges</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">nb_sink_edges</span> <span class="o">+</span> <span class="mf">0.00001</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>    <span class="k">def</span> <span class="nf">priority_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">to_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        Returns the nodes from which traffic has priority over from_node when going into to_node.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        This is traffic coming from the left in a roundabout, and any traffic when leaving a parking.</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        Args:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">            from_node (Node): the node to be checked for priority.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">            to_node (Node): the node to be checked for priority.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        Returns:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">            list[Node]: a list of nodes from which vehicles have priority.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="n">rnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="c1"># Determine which node has priority entering to_node.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="c1"># If from_node is a destination, all other nodes going into to_node have priority.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">from_node</span><span class="p">):</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">roads_to</span><span class="p">(</span><span class="n">to_node</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="o">!=</span> <span class="n">from_node</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="c1"># In a roundabout, a vehicle going S yields to one going W, E to S, N to E, and W to N.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">priority_rule</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">180</span> <span class="p">:</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">90</span> <span class="p">:</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">0</span> <span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">270</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">priority_direction</span> <span class="o">=</span> <span class="n">priority_rule</span><span class="p">[</span><span class="n">rnw</span><span class="p">[</span><span class="n">from_node</span><span class="p">][</span><span class="n">to_node</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]]</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">priority_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">rnw</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">to_node</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;direction&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">priority_direction</span><span class="p">]</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="c1"># If the priority node can reach to_node, return it, otherwise return nothing.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="n">priority_nodes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">to_node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="k">return</span> <span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="nf">road_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        Returns a list of all nodes which are connected by roads.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        Args:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">            condition: a condition that the nodes must satisfy. Defaults to always True.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">            list[Node]: the nodes connected by roads.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>    <span class="k">def</span> <span class="nf">destination_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        Returns a list of all nodes which are destinations.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        Args:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">            condition: a condition that the nodes must satisfy. Defaults to always True.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        Returns:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">            list[Node]: the destinations.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="k">def</span> <span class="nf">road_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Edge</span><span class="p">]:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        Returns a list of all edges that are roads.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        Returns:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">            list[Node]: the nodes connected by roads.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">Edge</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">edges</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)]</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">roads_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span> <span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        Returns a list of all nodes that can be reached by road from a given source node.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        If a condition function is provided, only nodes fulfilling that condition are returned.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        Args:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">            condition (Callable[[Node], bool], optional): a condition on the nodes. Defaults to always True.</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">            </span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">        Returns:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">            list[Node]: a list of nodes reachable by road.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">sink</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">sink</span><span class="p">)]</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="k">def</span> <span class="nf">roads_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span> <span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">        Returns a list of all nodes that can reach the given sink node by road.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        If a condition function is provided, only nodes fulfilling that condition are returned.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        Args:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">            sink (Node): the sink node.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">            condition (Callable[[Node], bool], optional): a condition on the nodes. Defaults to always True.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        Returns:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">            list[Node]: a list of nodes from which the sink node can be reached by road.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">source</span> <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">source</span><span class="p">)]</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="k">def</span> <span class="nf">is_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        Checks if a node is a destination.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        Args:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">        Returns:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">            bool: True if the node is a destination.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">def</span> <span class="nf">is_charging_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        Checks if a node is a charging point.</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">        Args:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        Returns:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">            bool: True if the node is a charging point.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;charging_point&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>    <span class="k">def</span> <span class="nf">edge_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Direction</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        Returns the direction of the edge going from source to sink.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        Args:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">            source (Node): source node.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">            sink (Node): sink node.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        Returns:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">            Direction: the direction in degrees.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="k">def</span> <span class="nf">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        Returns the shortest path from source to sink as a list of nodes.</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        Args:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">            target (Node): the target node.</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">        Returns:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">            list[Node]: the path.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                                <span class="n">weight</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">10000000</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="k">def</span> <span class="nf">path_to_nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        Given a source node and a list of target nodes, return the path to the nearest of the targets.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        Args:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">            targets (list[Node]): the list of target nodes.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">        Returns:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">            list[Node]: the path to the nearest target node.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="n">shortest_paths</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="n">shortest_paths</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="nb">len</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="n">shortest_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>    
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>    <span class="c1"># Provide reference to some of the RoadGridNetwork methods directly in the space.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>    <span class="k">def</span> <span class="nf">has_road_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>    <span class="k">def</span> <span class="nf">is_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>    <span class="k">def</span> <span class="nf">grid_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="c1"># Mesa space API (adapted from mesa.space.NetworkGrid)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>    <span class="k">def</span> <span class="nf">place_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Place an agent in a node.&quot;&quot;&quot;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="n">agent</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="c1"># If there are other agents in the node with which the agent cannot co-exist, raise an exception</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">can_coexist</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">: Agents cannot coexist: </span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="k">def</span> <span class="nf">get_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all adjacent nodes within a certain radius&quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="n">radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="k">if</span> <span class="n">include_center</span><span class="p">:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>                <span class="n">neighborhood</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="n">neighbors_with_distance</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">single_source_shortest_path_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_center</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>                <span class="k">del</span> <span class="n">neighbors_with_distance</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">neighbors_with_distance</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="k">return</span> <span class="n">neighborhood</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>    <span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all agents in adjacent nodes.&quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="n">neighborhood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">include_center</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_list_contents</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>    <span class="k">def</span> <span class="nf">move_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move an agent from its current node to a new node.&quot;&quot;&quot;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="s2">&quot;heading&quot;</span><span class="p">):</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">pos</span><span class="p">][</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>    <span class="k">def</span> <span class="nf">remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the agent from the network and set its pos attribute to None.&quot;&quot;&quot;</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pos</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="n">agent</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Node</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>    <span class="k">def</span> <span class="nf">is_cell_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a bool of the contents of a cell.&quot;&quot;&quot;</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>    <span class="k">def</span> <span class="nf">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of the agents contained in the nodes identified</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">        in `cell_list`; nodes with empty content are excluded.</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_cell_list_contents</span><span class="p">(</span><span class="n">cell_list</span><span class="p">))</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>    <span class="k">def</span> <span class="nf">get_all_cell_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of all the agents in the network.&quot;&quot;&quot;</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>    <span class="k">def</span> <span class="nf">iter_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an iterator of the agents contained in the nodes identified</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        in `cell_list`; nodes with empty content are excluded.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">filterfalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_cell_empty</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Node">
                    <div class="attr variable">
            <span class="name">Node</span>        =
<span class="default_value"><a href="#Node">space.Node</a></span>

        
    </div>
    <a class="headerlink" href="#Node"></a>
    
    

                </section>
                <section id="Edge">
                    <div class="attr variable">
            <span class="name">Edge</span>        =
<span class="default_value"><a href="#Edge">space.Edge</a></span>

        
    </div>
    <a class="headerlink" href="#Edge"></a>
    
    

                </section>
                <section id="Direction">
                    <div class="attr variable">
            <span class="name">Direction</span>        =
<span class="default_value">&lt;class &#39;int&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Direction"></a>
    
    

                </section>
                <section id="RoadGridGraph">
                            <input id="RoadGridGraph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RoadGridGraph</span><wbr>(<span class="base">networkx.classes.digraph.DiGraph</span>):

                <label class="view-source-button" for="RoadGridGraph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph-44"><a href="#RoadGridGraph-44"><span class="linenos"> 44</span></a><span class="k">class</span> <span class="nc">RoadGridGraph</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">):</span>
</span><span id="RoadGridGraph-45"><a href="#RoadGridGraph-45"><span class="linenos"> 45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-46"><a href="#RoadGridGraph-46"><span class="linenos"> 46</span></a><span class="sd">    A directed graph representing a 2D grid where the edges are labelled by direction in degrees.</span>
</span><span id="RoadGridGraph-47"><a href="#RoadGridGraph-47"><span class="linenos"> 47</span></a><span class="sd">    Roads are represented by having the node and edge attribute &quot;road&quot; set to True.</span>
</span><span id="RoadGridGraph-48"><a href="#RoadGridGraph-48"><span class="linenos"> 48</span></a><span class="sd">    Destinations are represented by having the node attribute &quot;destination&quot; set to True.</span>
</span><span id="RoadGridGraph-49"><a href="#RoadGridGraph-49"><span class="linenos"> 49</span></a><span class="sd">    Some destinations can also have charging points.</span>
</span><span id="RoadGridGraph-50"><a href="#RoadGridGraph-50"><span class="linenos"> 50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-51"><a href="#RoadGridGraph-51"><span class="linenos"> 51</span></a>
</span><span id="RoadGridGraph-52"><a href="#RoadGridGraph-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="RoadGridGraph-53"><a href="#RoadGridGraph-53"><span class="linenos"> 53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-54"><a href="#RoadGridGraph-54"><span class="linenos"> 54</span></a><span class="sd">        Creates the grid graph.</span>
</span><span id="RoadGridGraph-55"><a href="#RoadGridGraph-55"><span class="linenos"> 55</span></a><span class="sd">        </span>
</span><span id="RoadGridGraph-56"><a href="#RoadGridGraph-56"><span class="linenos"> 56</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-57"><a href="#RoadGridGraph-57"><span class="linenos"> 57</span></a><span class="sd">            width (int, optional): the width of the grid. Defaults to 0.</span>
</span><span id="RoadGridGraph-58"><a href="#RoadGridGraph-58"><span class="linenos"> 58</span></a><span class="sd">            height (int, optional): the height of the grid. Defaults to 0.</span>
</span><span id="RoadGridGraph-59"><a href="#RoadGridGraph-59"><span class="linenos"> 59</span></a>
</span><span id="RoadGridGraph-60"><a href="#RoadGridGraph-60"><span class="linenos"> 60</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph-61"><a href="#RoadGridGraph-61"><span class="linenos"> 61</span></a><span class="sd">            nx.DiGraph: the resulting graph.</span>
</span><span id="RoadGridGraph-62"><a href="#RoadGridGraph-62"><span class="linenos"> 62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-63"><a href="#RoadGridGraph-63"><span class="linenos"> 63</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="RoadGridGraph-64"><a href="#RoadGridGraph-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span id="RoadGridGraph-65"><a href="#RoadGridGraph-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span id="RoadGridGraph-66"><a href="#RoadGridGraph-66"><span class="linenos"> 66</span></a>
</span><span id="RoadGridGraph-67"><a href="#RoadGridGraph-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">grid_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadGridGraph-68"><a href="#RoadGridGraph-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-69"><a href="#RoadGridGraph-69"><span class="linenos"> 69</span></a><span class="sd">        Returns a list of all grid neighbors of a node. If diagonal is False, diagonal neighbors are not included.</span>
</span><span id="RoadGridGraph-70"><a href="#RoadGridGraph-70"><span class="linenos"> 70</span></a>
</span><span id="RoadGridGraph-71"><a href="#RoadGridGraph-71"><span class="linenos"> 71</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-72"><a href="#RoadGridGraph-72"><span class="linenos"> 72</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadGridGraph-73"><a href="#RoadGridGraph-73"><span class="linenos"> 73</span></a><span class="sd">            diagonal (bool, optional): if True, diagonal neighbors are included. Defaults to False.</span>
</span><span id="RoadGridGraph-74"><a href="#RoadGridGraph-74"><span class="linenos"> 74</span></a><span class="sd">            center (bool, optional): if True, the given node, which is at the center of the set, is included in the result. Defaults to False.</span>
</span><span id="RoadGridGraph-75"><a href="#RoadGridGraph-75"><span class="linenos"> 75</span></a><span class="sd">            dist (int, optional): if different from 1, include all nodes at this distance. Defaults to 1.</span>
</span><span id="RoadGridGraph-76"><a href="#RoadGridGraph-76"><span class="linenos"> 76</span></a>
</span><span id="RoadGridGraph-77"><a href="#RoadGridGraph-77"><span class="linenos"> 77</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph-78"><a href="#RoadGridGraph-78"><span class="linenos"> 78</span></a><span class="sd">            list[Node]: a list of grid neighbors.</span>
</span><span id="RoadGridGraph-79"><a href="#RoadGridGraph-79"><span class="linenos"> 79</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-80"><a href="#RoadGridGraph-80"><span class="linenos"> 80</span></a>        <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="RoadGridGraph-81"><a href="#RoadGridGraph-81"><span class="linenos"> 81</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RoadGridGraph-82"><a href="#RoadGridGraph-82"><span class="linenos"> 82</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ax</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ax</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)):</span>
</span><span id="RoadGridGraph-83"><a href="#RoadGridGraph-83"><span class="linenos"> 83</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ay</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ay</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)):</span>
</span><span id="RoadGridGraph-84"><a href="#RoadGridGraph-84"><span class="linenos"> 84</span></a>                <span class="k">if</span> <span class="n">diagonal</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="n">ay</span><span class="p">:</span>
</span><span id="RoadGridGraph-85"><a href="#RoadGridGraph-85"><span class="linenos"> 85</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</span><span id="RoadGridGraph-86"><a href="#RoadGridGraph-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">center</span><span class="p">:</span>
</span><span id="RoadGridGraph-87"><a href="#RoadGridGraph-87"><span class="linenos"> 87</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="RoadGridGraph-88"><a href="#RoadGridGraph-88"><span class="linenos"> 88</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="RoadGridGraph-89"><a href="#RoadGridGraph-89"><span class="linenos"> 89</span></a>
</span><span id="RoadGridGraph-90"><a href="#RoadGridGraph-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">add_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="RoadGridGraph-91"><a href="#RoadGridGraph-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-92"><a href="#RoadGridGraph-92"><span class="linenos"> 92</span></a><span class="sd">        Adds a road from the source node to the sink node.</span>
</span><span id="RoadGridGraph-93"><a href="#RoadGridGraph-93"><span class="linenos"> 93</span></a>
</span><span id="RoadGridGraph-94"><a href="#RoadGridGraph-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-95"><a href="#RoadGridGraph-95"><span class="linenos"> 95</span></a><span class="sd">            source (Node): source node.</span>
</span><span id="RoadGridGraph-96"><a href="#RoadGridGraph-96"><span class="linenos"> 96</span></a><span class="sd">            sink (Node): sink node.</span>
</span><span id="RoadGridGraph-97"><a href="#RoadGridGraph-97"><span class="linenos"> 97</span></a><span class="sd">            bidirectional (bool, optional): if True, the road in opposite direction is also added. Defaults to False.</span>
</span><span id="RoadGridGraph-98"><a href="#RoadGridGraph-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-99"><a href="#RoadGridGraph-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</span><span id="RoadGridGraph-100"><a href="#RoadGridGraph-100"><span class="linenos">100</span></a>
</span><span id="RoadGridGraph-101"><a href="#RoadGridGraph-101"><span class="linenos">101</span></a>        <span class="c1"># Set the default attribute values of nodes and edges</span>
</span><span id="RoadGridGraph-102"><a href="#RoadGridGraph-102"><span class="linenos">102</span></a>        <span class="c1"># TODO: Do this only if the attributes have not yet been defined</span>
</span><span id="RoadGridGraph-103"><a href="#RoadGridGraph-103"><span class="linenos">103</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">]:</span>
</span><span id="RoadGridGraph-104"><a href="#RoadGridGraph-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph-105"><a href="#RoadGridGraph-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RoadGridGraph-106"><a href="#RoadGridGraph-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;charging_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RoadGridGraph-107"><a href="#RoadGridGraph-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RoadGridGraph-108"><a href="#RoadGridGraph-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph-109"><a href="#RoadGridGraph-109"><span class="linenos">109</span></a>        <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</span><span id="RoadGridGraph-110"><a href="#RoadGridGraph-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span>
</span><span id="RoadGridGraph-111"><a href="#RoadGridGraph-111"><span class="linenos">111</span></a>
</span><span id="RoadGridGraph-112"><a href="#RoadGridGraph-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">bidirectional</span><span class="p">:</span>
</span><span id="RoadGridGraph-113"><a href="#RoadGridGraph-113"><span class="linenos">113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="RoadGridGraph-114"><a href="#RoadGridGraph-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">sink</span><span class="p">][</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph-115"><a href="#RoadGridGraph-115"><span class="linenos">115</span></a>            <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="RoadGridGraph-116"><a href="#RoadGridGraph-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">sink</span><span class="p">][</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span>
</span><span id="RoadGridGraph-117"><a href="#RoadGridGraph-117"><span class="linenos">117</span></a>
</span><span id="RoadGridGraph-118"><a href="#RoadGridGraph-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">add_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">directions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Direction</span><span class="p">]):</span>
</span><span id="RoadGridGraph-119"><a href="#RoadGridGraph-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-120"><a href="#RoadGridGraph-120"><span class="linenos">120</span></a><span class="sd">        Adds a sequence of roads to the network, starting in the provided node and going in the provided directions.</span>
</span><span id="RoadGridGraph-121"><a href="#RoadGridGraph-121"><span class="linenos">121</span></a>
</span><span id="RoadGridGraph-122"><a href="#RoadGridGraph-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-123"><a href="#RoadGridGraph-123"><span class="linenos">123</span></a><span class="sd">            node (Node): the start node.</span>
</span><span id="RoadGridGraph-124"><a href="#RoadGridGraph-124"><span class="linenos">124</span></a><span class="sd">            directions (list[Direction]): a list containing directions in degrees.</span>
</span><span id="RoadGridGraph-125"><a href="#RoadGridGraph-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-126"><a href="#RoadGridGraph-126"><span class="linenos">126</span></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">directions</span><span class="p">:</span>
</span><span id="RoadGridGraph-127"><a href="#RoadGridGraph-127"><span class="linenos">127</span></a>            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="RoadGridGraph-128"><a href="#RoadGridGraph-128"><span class="linenos">128</span></a>            <span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">90</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> <span class="mi">180</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">270</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="p">}</span>
</span><span id="RoadGridGraph-129"><a href="#RoadGridGraph-129"><span class="linenos">129</span></a>            <span class="n">next_node</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
</span><span id="RoadGridGraph-130"><a href="#RoadGridGraph-130"><span class="linenos">130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">next_node</span><span class="p">)</span>
</span><span id="RoadGridGraph-131"><a href="#RoadGridGraph-131"><span class="linenos">131</span></a>            <span class="n">node</span> <span class="o">=</span> <span class="n">next_node</span>
</span><span id="RoadGridGraph-132"><a href="#RoadGridGraph-132"><span class="linenos">132</span></a>
</span><span id="RoadGridGraph-133"><a href="#RoadGridGraph-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">add_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">charging_point</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="RoadGridGraph-134"><a href="#RoadGridGraph-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-135"><a href="#RoadGridGraph-135"><span class="linenos">135</span></a><span class="sd">        Adds a destination node, as a neighbor of the given node.</span>
</span><span id="RoadGridGraph-136"><a href="#RoadGridGraph-136"><span class="linenos">136</span></a><span class="sd">        Roads are added to and from the destination from the node.</span>
</span><span id="RoadGridGraph-137"><a href="#RoadGridGraph-137"><span class="linenos">137</span></a><span class="sd">        The destination node is indicated as such using a node attribute.</span>
</span><span id="RoadGridGraph-138"><a href="#RoadGridGraph-138"><span class="linenos">138</span></a><span class="sd">        </span>
</span><span id="RoadGridGraph-139"><a href="#RoadGridGraph-139"><span class="linenos">139</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-140"><a href="#RoadGridGraph-140"><span class="linenos">140</span></a><span class="sd">            node1 (Node): the node to be connected to the destination.</span>
</span><span id="RoadGridGraph-141"><a href="#RoadGridGraph-141"><span class="linenos">141</span></a><span class="sd">            node2 (Node): the destination.</span>
</span><span id="RoadGridGraph-142"><a href="#RoadGridGraph-142"><span class="linenos">142</span></a><span class="sd">            charging_point (bool, optional): if True, the destination is a charging point. Defaults to False.</span>
</span><span id="RoadGridGraph-143"><a href="#RoadGridGraph-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-144"><a href="#RoadGridGraph-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="RoadGridGraph-145"><a href="#RoadGridGraph-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node2</span><span class="p">][</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph-146"><a href="#RoadGridGraph-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="n">charging_point</span><span class="p">:</span>
</span><span id="RoadGridGraph-147"><a href="#RoadGridGraph-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node2</span><span class="p">][</span><span class="s2">&quot;charging_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph-148"><a href="#RoadGridGraph-148"><span class="linenos">148</span></a>
</span><span id="RoadGridGraph-149"><a href="#RoadGridGraph-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">has_road_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadGridGraph-150"><a href="#RoadGridGraph-150"><span class="linenos">150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-151"><a href="#RoadGridGraph-151"><span class="linenos">151</span></a><span class="sd">        Returns True if and only if the graph has a road from the given node in the given direction.</span>
</span><span id="RoadGridGraph-152"><a href="#RoadGridGraph-152"><span class="linenos">152</span></a>
</span><span id="RoadGridGraph-153"><a href="#RoadGridGraph-153"><span class="linenos">153</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-154"><a href="#RoadGridGraph-154"><span class="linenos">154</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadGridGraph-155"><a href="#RoadGridGraph-155"><span class="linenos">155</span></a><span class="sd">            direction (Direction): the direction in degrees.</span>
</span><span id="RoadGridGraph-156"><a href="#RoadGridGraph-156"><span class="linenos">156</span></a>
</span><span id="RoadGridGraph-157"><a href="#RoadGridGraph-157"><span class="linenos">157</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph-158"><a href="#RoadGridGraph-158"><span class="linenos">158</span></a><span class="sd">            bool: _description_</span>
</span><span id="RoadGridGraph-159"><a href="#RoadGridGraph-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-160"><a href="#RoadGridGraph-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">direction</span> <span class="k">for</span> <span class="n">sink</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">))</span>
</span><span id="RoadGridGraph-161"><a href="#RoadGridGraph-161"><span class="linenos">161</span></a>
</span><span id="RoadGridGraph-162"><a href="#RoadGridGraph-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">is_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadGridGraph-163"><a href="#RoadGridGraph-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-164"><a href="#RoadGridGraph-164"><span class="linenos">164</span></a><span class="sd">        Checks if a node or an edge is a road. If two nodes are given, it checks the edge, otherwise the node.</span>
</span><span id="RoadGridGraph-165"><a href="#RoadGridGraph-165"><span class="linenos">165</span></a>
</span><span id="RoadGridGraph-166"><a href="#RoadGridGraph-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-167"><a href="#RoadGridGraph-167"><span class="linenos">167</span></a><span class="sd">            node1 (Node): a node.</span>
</span><span id="RoadGridGraph-168"><a href="#RoadGridGraph-168"><span class="linenos">168</span></a><span class="sd">            node2 (Node, optional): a second node, if checking an edge. Defaults to None.</span>
</span><span id="RoadGridGraph-169"><a href="#RoadGridGraph-169"><span class="linenos">169</span></a>
</span><span id="RoadGridGraph-170"><a href="#RoadGridGraph-170"><span class="linenos">170</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph-171"><a href="#RoadGridGraph-171"><span class="linenos">171</span></a><span class="sd">            bool: True if the node or edge is a road.</span>
</span><span id="RoadGridGraph-172"><a href="#RoadGridGraph-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-173"><a href="#RoadGridGraph-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">node2</span><span class="p">:</span>
</span><span id="RoadGridGraph-174"><a href="#RoadGridGraph-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">node1</span><span class="p">][</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="RoadGridGraph-175"><a href="#RoadGridGraph-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RoadGridGraph-176"><a href="#RoadGridGraph-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="RoadGridGraph-177"><a href="#RoadGridGraph-177"><span class="linenos">177</span></a>
</span><span id="RoadGridGraph-178"><a href="#RoadGridGraph-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">road_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="RoadGridGraph-179"><a href="#RoadGridGraph-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-180"><a href="#RoadGridGraph-180"><span class="linenos">180</span></a><span class="sd">        Returns the number of outgoing roads from a node.</span>
</span><span id="RoadGridGraph-181"><a href="#RoadGridGraph-181"><span class="linenos">181</span></a>
</span><span id="RoadGridGraph-182"><a href="#RoadGridGraph-182"><span class="linenos">182</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph-183"><a href="#RoadGridGraph-183"><span class="linenos">183</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadGridGraph-184"><a href="#RoadGridGraph-184"><span class="linenos">184</span></a>
</span><span id="RoadGridGraph-185"><a href="#RoadGridGraph-185"><span class="linenos">185</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph-186"><a href="#RoadGridGraph-186"><span class="linenos">186</span></a><span class="sd">            int: the number of outgoing roads.</span>
</span><span id="RoadGridGraph-187"><a href="#RoadGridGraph-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph-188"><a href="#RoadGridGraph-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">sink</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>A directed graph representing a 2D grid where the edges are labelled by direction in degrees.
Roads are represented by having the node and edge attribute "road" set to True.
Destinations are represented by having the node attribute "destination" set to True.
Some destinations can also have charging points.</p>
</div>


                            <div id="RoadGridGraph.__init__" class="classattr">
                                        <input id="RoadGridGraph.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RoadGridGraph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>, </span><span class="param"><span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span>)</span>

                <label class="view-source-button" for="RoadGridGraph.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.__init__-52"><a href="#RoadGridGraph.__init__-52"><span class="linenos">52</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="RoadGridGraph.__init__-53"><a href="#RoadGridGraph.__init__-53"><span class="linenos">53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.__init__-54"><a href="#RoadGridGraph.__init__-54"><span class="linenos">54</span></a><span class="sd">        Creates the grid graph.</span>
</span><span id="RoadGridGraph.__init__-55"><a href="#RoadGridGraph.__init__-55"><span class="linenos">55</span></a><span class="sd">        </span>
</span><span id="RoadGridGraph.__init__-56"><a href="#RoadGridGraph.__init__-56"><span class="linenos">56</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.__init__-57"><a href="#RoadGridGraph.__init__-57"><span class="linenos">57</span></a><span class="sd">            width (int, optional): the width of the grid. Defaults to 0.</span>
</span><span id="RoadGridGraph.__init__-58"><a href="#RoadGridGraph.__init__-58"><span class="linenos">58</span></a><span class="sd">            height (int, optional): the height of the grid. Defaults to 0.</span>
</span><span id="RoadGridGraph.__init__-59"><a href="#RoadGridGraph.__init__-59"><span class="linenos">59</span></a>
</span><span id="RoadGridGraph.__init__-60"><a href="#RoadGridGraph.__init__-60"><span class="linenos">60</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph.__init__-61"><a href="#RoadGridGraph.__init__-61"><span class="linenos">61</span></a><span class="sd">            nx.DiGraph: the resulting graph.</span>
</span><span id="RoadGridGraph.__init__-62"><a href="#RoadGridGraph.__init__-62"><span class="linenos">62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.__init__-63"><a href="#RoadGridGraph.__init__-63"><span class="linenos">63</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="RoadGridGraph.__init__-64"><a href="#RoadGridGraph.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span id="RoadGridGraph.__init__-65"><a href="#RoadGridGraph.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span></pre></div>


            <div class="docstring"><p>Creates the grid graph.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>width (int, optional):</strong>  the width of the grid. Defaults to 0.</li>
<li><strong>height (int, optional):</strong>  the height of the grid. Defaults to 0.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>nx.DiGraph: the resulting graph.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadGridGraph.width" class="classattr">
                                <div class="attr variable">
            <span class="name">width</span>

        
    </div>
    <a class="headerlink" href="#RoadGridGraph.width"></a>
    
    

                            </div>
                            <div id="RoadGridGraph.height" class="classattr">
                                <div class="attr variable">
            <span class="name">height</span>

        
    </div>
    <a class="headerlink" href="#RoadGridGraph.height"></a>
    
    

                            </div>
                            <div id="RoadGridGraph.grid_neighbors" class="classattr">
                                        <input id="RoadGridGraph.grid_neighbors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grid_neighbors</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadGridGraph.grid_neighbors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.grid_neighbors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.grid_neighbors-67"><a href="#RoadGridGraph.grid_neighbors-67"><span class="linenos">67</span></a>    <span class="k">def</span> <span class="nf">grid_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadGridGraph.grid_neighbors-68"><a href="#RoadGridGraph.grid_neighbors-68"><span class="linenos">68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.grid_neighbors-69"><a href="#RoadGridGraph.grid_neighbors-69"><span class="linenos">69</span></a><span class="sd">        Returns a list of all grid neighbors of a node. If diagonal is False, diagonal neighbors are not included.</span>
</span><span id="RoadGridGraph.grid_neighbors-70"><a href="#RoadGridGraph.grid_neighbors-70"><span class="linenos">70</span></a>
</span><span id="RoadGridGraph.grid_neighbors-71"><a href="#RoadGridGraph.grid_neighbors-71"><span class="linenos">71</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.grid_neighbors-72"><a href="#RoadGridGraph.grid_neighbors-72"><span class="linenos">72</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadGridGraph.grid_neighbors-73"><a href="#RoadGridGraph.grid_neighbors-73"><span class="linenos">73</span></a><span class="sd">            diagonal (bool, optional): if True, diagonal neighbors are included. Defaults to False.</span>
</span><span id="RoadGridGraph.grid_neighbors-74"><a href="#RoadGridGraph.grid_neighbors-74"><span class="linenos">74</span></a><span class="sd">            center (bool, optional): if True, the given node, which is at the center of the set, is included in the result. Defaults to False.</span>
</span><span id="RoadGridGraph.grid_neighbors-75"><a href="#RoadGridGraph.grid_neighbors-75"><span class="linenos">75</span></a><span class="sd">            dist (int, optional): if different from 1, include all nodes at this distance. Defaults to 1.</span>
</span><span id="RoadGridGraph.grid_neighbors-76"><a href="#RoadGridGraph.grid_neighbors-76"><span class="linenos">76</span></a>
</span><span id="RoadGridGraph.grid_neighbors-77"><a href="#RoadGridGraph.grid_neighbors-77"><span class="linenos">77</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph.grid_neighbors-78"><a href="#RoadGridGraph.grid_neighbors-78"><span class="linenos">78</span></a><span class="sd">            list[Node]: a list of grid neighbors.</span>
</span><span id="RoadGridGraph.grid_neighbors-79"><a href="#RoadGridGraph.grid_neighbors-79"><span class="linenos">79</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.grid_neighbors-80"><a href="#RoadGridGraph.grid_neighbors-80"><span class="linenos">80</span></a>        <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="RoadGridGraph.grid_neighbors-81"><a href="#RoadGridGraph.grid_neighbors-81"><span class="linenos">81</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RoadGridGraph.grid_neighbors-82"><a href="#RoadGridGraph.grid_neighbors-82"><span class="linenos">82</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ax</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ax</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)):</span>
</span><span id="RoadGridGraph.grid_neighbors-83"><a href="#RoadGridGraph.grid_neighbors-83"><span class="linenos">83</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ay</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ay</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)):</span>
</span><span id="RoadGridGraph.grid_neighbors-84"><a href="#RoadGridGraph.grid_neighbors-84"><span class="linenos">84</span></a>                <span class="k">if</span> <span class="n">diagonal</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="n">ay</span><span class="p">:</span>
</span><span id="RoadGridGraph.grid_neighbors-85"><a href="#RoadGridGraph.grid_neighbors-85"><span class="linenos">85</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</span><span id="RoadGridGraph.grid_neighbors-86"><a href="#RoadGridGraph.grid_neighbors-86"><span class="linenos">86</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">center</span><span class="p">:</span>
</span><span id="RoadGridGraph.grid_neighbors-87"><a href="#RoadGridGraph.grid_neighbors-87"><span class="linenos">87</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="RoadGridGraph.grid_neighbors-88"><a href="#RoadGridGraph.grid_neighbors-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all grid neighbors of a node. If diagonal is False, diagonal neighbors are not included.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node (Node):</strong>  the node.</li>
<li><strong>diagonal (bool, optional):</strong>  if True, diagonal neighbors are included. Defaults to False.</li>
<li><strong>center (bool, optional):</strong>  if True, the given node, which is at the center of the set, is included in the result. Defaults to False.</li>
<li><strong>dist (int, optional):</strong>  if different from 1, include all nodes at this distance. Defaults to 1.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: a list of grid neighbors.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadGridGraph.add_road" class="classattr">
                                        <input id="RoadGridGraph.add_road-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_road</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">sink</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RoadGridGraph.add_road-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.add_road"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.add_road-90"><a href="#RoadGridGraph.add_road-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">add_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">bidirectional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="RoadGridGraph.add_road-91"><a href="#RoadGridGraph.add_road-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.add_road-92"><a href="#RoadGridGraph.add_road-92"><span class="linenos"> 92</span></a><span class="sd">        Adds a road from the source node to the sink node.</span>
</span><span id="RoadGridGraph.add_road-93"><a href="#RoadGridGraph.add_road-93"><span class="linenos"> 93</span></a>
</span><span id="RoadGridGraph.add_road-94"><a href="#RoadGridGraph.add_road-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.add_road-95"><a href="#RoadGridGraph.add_road-95"><span class="linenos"> 95</span></a><span class="sd">            source (Node): source node.</span>
</span><span id="RoadGridGraph.add_road-96"><a href="#RoadGridGraph.add_road-96"><span class="linenos"> 96</span></a><span class="sd">            sink (Node): sink node.</span>
</span><span id="RoadGridGraph.add_road-97"><a href="#RoadGridGraph.add_road-97"><span class="linenos"> 97</span></a><span class="sd">            bidirectional (bool, optional): if True, the road in opposite direction is also added. Defaults to False.</span>
</span><span id="RoadGridGraph.add_road-98"><a href="#RoadGridGraph.add_road-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.add_road-99"><a href="#RoadGridGraph.add_road-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</span><span id="RoadGridGraph.add_road-100"><a href="#RoadGridGraph.add_road-100"><span class="linenos">100</span></a>
</span><span id="RoadGridGraph.add_road-101"><a href="#RoadGridGraph.add_road-101"><span class="linenos">101</span></a>        <span class="c1"># Set the default attribute values of nodes and edges</span>
</span><span id="RoadGridGraph.add_road-102"><a href="#RoadGridGraph.add_road-102"><span class="linenos">102</span></a>        <span class="c1"># TODO: Do this only if the attributes have not yet been defined</span>
</span><span id="RoadGridGraph.add_road-103"><a href="#RoadGridGraph.add_road-103"><span class="linenos">103</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">]:</span>
</span><span id="RoadGridGraph.add_road-104"><a href="#RoadGridGraph.add_road-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph.add_road-105"><a href="#RoadGridGraph.add_road-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RoadGridGraph.add_road-106"><a href="#RoadGridGraph.add_road-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;charging_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RoadGridGraph.add_road-107"><a href="#RoadGridGraph.add_road-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RoadGridGraph.add_road-108"><a href="#RoadGridGraph.add_road-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph.add_road-109"><a href="#RoadGridGraph.add_road-109"><span class="linenos">109</span></a>        <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
</span><span id="RoadGridGraph.add_road-110"><a href="#RoadGridGraph.add_road-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span>
</span><span id="RoadGridGraph.add_road-111"><a href="#RoadGridGraph.add_road-111"><span class="linenos">111</span></a>
</span><span id="RoadGridGraph.add_road-112"><a href="#RoadGridGraph.add_road-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">bidirectional</span><span class="p">:</span>
</span><span id="RoadGridGraph.add_road-113"><a href="#RoadGridGraph.add_road-113"><span class="linenos">113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="RoadGridGraph.add_road-114"><a href="#RoadGridGraph.add_road-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">sink</span><span class="p">][</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph.add_road-115"><a href="#RoadGridGraph.add_road-115"><span class="linenos">115</span></a>            <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="RoadGridGraph.add_road-116"><a href="#RoadGridGraph.add_road-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">sink</span><span class="p">][</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">90</span>
</span></pre></div>


            <div class="docstring"><p>Adds a road from the source node to the sink node.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>source (Node):</strong>  source node.</li>
<li><strong>sink (Node):</strong>  sink node.</li>
<li><strong>bidirectional (bool, optional):</strong>  if True, the road in opposite direction is also added. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="RoadGridGraph.add_roads" class="classattr">
                                        <input id="RoadGridGraph.add_roads-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_roads</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">directions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RoadGridGraph.add_roads-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.add_roads"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.add_roads-118"><a href="#RoadGridGraph.add_roads-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">add_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">directions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Direction</span><span class="p">]):</span>
</span><span id="RoadGridGraph.add_roads-119"><a href="#RoadGridGraph.add_roads-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.add_roads-120"><a href="#RoadGridGraph.add_roads-120"><span class="linenos">120</span></a><span class="sd">        Adds a sequence of roads to the network, starting in the provided node and going in the provided directions.</span>
</span><span id="RoadGridGraph.add_roads-121"><a href="#RoadGridGraph.add_roads-121"><span class="linenos">121</span></a>
</span><span id="RoadGridGraph.add_roads-122"><a href="#RoadGridGraph.add_roads-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.add_roads-123"><a href="#RoadGridGraph.add_roads-123"><span class="linenos">123</span></a><span class="sd">            node (Node): the start node.</span>
</span><span id="RoadGridGraph.add_roads-124"><a href="#RoadGridGraph.add_roads-124"><span class="linenos">124</span></a><span class="sd">            directions (list[Direction]): a list containing directions in degrees.</span>
</span><span id="RoadGridGraph.add_roads-125"><a href="#RoadGridGraph.add_roads-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.add_roads-126"><a href="#RoadGridGraph.add_roads-126"><span class="linenos">126</span></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">directions</span><span class="p">:</span>
</span><span id="RoadGridGraph.add_roads-127"><a href="#RoadGridGraph.add_roads-127"><span class="linenos">127</span></a>            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="RoadGridGraph.add_roads-128"><a href="#RoadGridGraph.add_roads-128"><span class="linenos">128</span></a>            <span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">90</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> <span class="mi">180</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">270</span> <span class="p">:</span> <span class="n">Node</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="p">}</span>
</span><span id="RoadGridGraph.add_roads-129"><a href="#RoadGridGraph.add_roads-129"><span class="linenos">129</span></a>            <span class="n">next_node</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
</span><span id="RoadGridGraph.add_roads-130"><a href="#RoadGridGraph.add_roads-130"><span class="linenos">130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">next_node</span><span class="p">)</span>
</span><span id="RoadGridGraph.add_roads-131"><a href="#RoadGridGraph.add_roads-131"><span class="linenos">131</span></a>            <span class="n">node</span> <span class="o">=</span> <span class="n">next_node</span>
</span></pre></div>


            <div class="docstring"><p>Adds a sequence of roads to the network, starting in the provided node and going in the provided directions.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node (Node):</strong>  the start node.</li>
<li><strong>directions (list[Direction]):</strong>  a list containing directions in degrees.</li>
</ul>
</div>


                            </div>
                            <div id="RoadGridGraph.add_destination" class="classattr">
                                        <input id="RoadGridGraph.add_destination-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_destination</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">node1</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">node2</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">charging_point</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RoadGridGraph.add_destination-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.add_destination"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.add_destination-133"><a href="#RoadGridGraph.add_destination-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">add_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">charging_point</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="RoadGridGraph.add_destination-134"><a href="#RoadGridGraph.add_destination-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.add_destination-135"><a href="#RoadGridGraph.add_destination-135"><span class="linenos">135</span></a><span class="sd">        Adds a destination node, as a neighbor of the given node.</span>
</span><span id="RoadGridGraph.add_destination-136"><a href="#RoadGridGraph.add_destination-136"><span class="linenos">136</span></a><span class="sd">        Roads are added to and from the destination from the node.</span>
</span><span id="RoadGridGraph.add_destination-137"><a href="#RoadGridGraph.add_destination-137"><span class="linenos">137</span></a><span class="sd">        The destination node is indicated as such using a node attribute.</span>
</span><span id="RoadGridGraph.add_destination-138"><a href="#RoadGridGraph.add_destination-138"><span class="linenos">138</span></a><span class="sd">        </span>
</span><span id="RoadGridGraph.add_destination-139"><a href="#RoadGridGraph.add_destination-139"><span class="linenos">139</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.add_destination-140"><a href="#RoadGridGraph.add_destination-140"><span class="linenos">140</span></a><span class="sd">            node1 (Node): the node to be connected to the destination.</span>
</span><span id="RoadGridGraph.add_destination-141"><a href="#RoadGridGraph.add_destination-141"><span class="linenos">141</span></a><span class="sd">            node2 (Node): the destination.</span>
</span><span id="RoadGridGraph.add_destination-142"><a href="#RoadGridGraph.add_destination-142"><span class="linenos">142</span></a><span class="sd">            charging_point (bool, optional): if True, the destination is a charging point. Defaults to False.</span>
</span><span id="RoadGridGraph.add_destination-143"><a href="#RoadGridGraph.add_destination-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.add_destination-144"><a href="#RoadGridGraph.add_destination-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="RoadGridGraph.add_destination-145"><a href="#RoadGridGraph.add_destination-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node2</span><span class="p">][</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RoadGridGraph.add_destination-146"><a href="#RoadGridGraph.add_destination-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="n">charging_point</span><span class="p">:</span>
</span><span id="RoadGridGraph.add_destination-147"><a href="#RoadGridGraph.add_destination-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node2</span><span class="p">][</span><span class="s2">&quot;charging_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Adds a destination node, as a neighbor of the given node.
Roads are added to and from the destination from the node.
The destination node is indicated as such using a node attribute.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node1 (Node):</strong>  the node to be connected to the destination.</li>
<li><strong>node2 (Node):</strong>  the destination.</li>
<li><strong>charging_point (bool, optional):</strong>  if True, the destination is a charging point. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="RoadGridGraph.has_road_to" class="classattr">
                                        <input id="RoadGridGraph.has_road_to-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_road_to</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">direction</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadGridGraph.has_road_to-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.has_road_to"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.has_road_to-149"><a href="#RoadGridGraph.has_road_to-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">has_road_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadGridGraph.has_road_to-150"><a href="#RoadGridGraph.has_road_to-150"><span class="linenos">150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.has_road_to-151"><a href="#RoadGridGraph.has_road_to-151"><span class="linenos">151</span></a><span class="sd">        Returns True if and only if the graph has a road from the given node in the given direction.</span>
</span><span id="RoadGridGraph.has_road_to-152"><a href="#RoadGridGraph.has_road_to-152"><span class="linenos">152</span></a>
</span><span id="RoadGridGraph.has_road_to-153"><a href="#RoadGridGraph.has_road_to-153"><span class="linenos">153</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.has_road_to-154"><a href="#RoadGridGraph.has_road_to-154"><span class="linenos">154</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadGridGraph.has_road_to-155"><a href="#RoadGridGraph.has_road_to-155"><span class="linenos">155</span></a><span class="sd">            direction (Direction): the direction in degrees.</span>
</span><span id="RoadGridGraph.has_road_to-156"><a href="#RoadGridGraph.has_road_to-156"><span class="linenos">156</span></a>
</span><span id="RoadGridGraph.has_road_to-157"><a href="#RoadGridGraph.has_road_to-157"><span class="linenos">157</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph.has_road_to-158"><a href="#RoadGridGraph.has_road_to-158"><span class="linenos">158</span></a><span class="sd">            bool: _description_</span>
</span><span id="RoadGridGraph.has_road_to-159"><a href="#RoadGridGraph.has_road_to-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.has_road_to-160"><a href="#RoadGridGraph.has_road_to-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">direction</span> <span class="k">for</span> <span class="n">sink</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if and only if the graph has a road from the given node in the given direction.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>source (Node):</strong>  the source node.</li>
<li><strong>direction (Direction):</strong>  the direction in degrees.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: _description_</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadGridGraph.is_road" class="classattr">
                                        <input id="RoadGridGraph.is_road-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_road</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node1</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadGridGraph.is_road-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.is_road"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.is_road-162"><a href="#RoadGridGraph.is_road-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">is_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadGridGraph.is_road-163"><a href="#RoadGridGraph.is_road-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.is_road-164"><a href="#RoadGridGraph.is_road-164"><span class="linenos">164</span></a><span class="sd">        Checks if a node or an edge is a road. If two nodes are given, it checks the edge, otherwise the node.</span>
</span><span id="RoadGridGraph.is_road-165"><a href="#RoadGridGraph.is_road-165"><span class="linenos">165</span></a>
</span><span id="RoadGridGraph.is_road-166"><a href="#RoadGridGraph.is_road-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.is_road-167"><a href="#RoadGridGraph.is_road-167"><span class="linenos">167</span></a><span class="sd">            node1 (Node): a node.</span>
</span><span id="RoadGridGraph.is_road-168"><a href="#RoadGridGraph.is_road-168"><span class="linenos">168</span></a><span class="sd">            node2 (Node, optional): a second node, if checking an edge. Defaults to None.</span>
</span><span id="RoadGridGraph.is_road-169"><a href="#RoadGridGraph.is_road-169"><span class="linenos">169</span></a>
</span><span id="RoadGridGraph.is_road-170"><a href="#RoadGridGraph.is_road-170"><span class="linenos">170</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph.is_road-171"><a href="#RoadGridGraph.is_road-171"><span class="linenos">171</span></a><span class="sd">            bool: True if the node or edge is a road.</span>
</span><span id="RoadGridGraph.is_road-172"><a href="#RoadGridGraph.is_road-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.is_road-173"><a href="#RoadGridGraph.is_road-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">node2</span><span class="p">:</span>
</span><span id="RoadGridGraph.is_road-174"><a href="#RoadGridGraph.is_road-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">node1</span><span class="p">][</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="RoadGridGraph.is_road-175"><a href="#RoadGridGraph.is_road-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RoadGridGraph.is_road-176"><a href="#RoadGridGraph.is_road-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks if a node or an edge is a road. If two nodes are given, it checks the edge, otherwise the node.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node1 (Node):</strong>  a node.</li>
<li><strong>node2 (Node, optional):</strong>  a second node, if checking an edge. Defaults to None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True if the node or edge is a road.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadGridGraph.road_degree" class="classattr">
                                        <input id="RoadGridGraph.road_degree-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">road_degree</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="RoadGridGraph.road_degree-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadGridGraph.road_degree"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadGridGraph.road_degree-178"><a href="#RoadGridGraph.road_degree-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">road_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="RoadGridGraph.road_degree-179"><a href="#RoadGridGraph.road_degree-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.road_degree-180"><a href="#RoadGridGraph.road_degree-180"><span class="linenos">180</span></a><span class="sd">        Returns the number of outgoing roads from a node.</span>
</span><span id="RoadGridGraph.road_degree-181"><a href="#RoadGridGraph.road_degree-181"><span class="linenos">181</span></a>
</span><span id="RoadGridGraph.road_degree-182"><a href="#RoadGridGraph.road_degree-182"><span class="linenos">182</span></a><span class="sd">        Args:</span>
</span><span id="RoadGridGraph.road_degree-183"><a href="#RoadGridGraph.road_degree-183"><span class="linenos">183</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadGridGraph.road_degree-184"><a href="#RoadGridGraph.road_degree-184"><span class="linenos">184</span></a>
</span><span id="RoadGridGraph.road_degree-185"><a href="#RoadGridGraph.road_degree-185"><span class="linenos">185</span></a><span class="sd">        Returns:</span>
</span><span id="RoadGridGraph.road_degree-186"><a href="#RoadGridGraph.road_degree-186"><span class="linenos">186</span></a><span class="sd">            int: the number of outgoing roads.</span>
</span><span id="RoadGridGraph.road_degree-187"><a href="#RoadGridGraph.road_degree-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadGridGraph.road_degree-188"><a href="#RoadGridGraph.road_degree-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">sink</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Returns the number of outgoing roads from a node.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node (Node):</strong>  the node.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>int: the number of outgoing roads.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>networkx.classes.digraph.DiGraph</dt>
                                <dd id="RoadGridGraph.graph" class="variable">graph</dd>
                <dd id="RoadGridGraph.adj" class="variable">adj</dd>
                <dd id="RoadGridGraph.succ" class="variable">succ</dd>
                <dd id="RoadGridGraph.pred" class="variable">pred</dd>
                <dd id="RoadGridGraph.add_node" class="function">add_node</dd>
                <dd id="RoadGridGraph.add_nodes_from" class="function">add_nodes_from</dd>
                <dd id="RoadGridGraph.remove_node" class="function">remove_node</dd>
                <dd id="RoadGridGraph.remove_nodes_from" class="function">remove_nodes_from</dd>
                <dd id="RoadGridGraph.add_edge" class="function">add_edge</dd>
                <dd id="RoadGridGraph.add_edges_from" class="function">add_edges_from</dd>
                <dd id="RoadGridGraph.remove_edge" class="function">remove_edge</dd>
                <dd id="RoadGridGraph.remove_edges_from" class="function">remove_edges_from</dd>
                <dd id="RoadGridGraph.has_successor" class="function">has_successor</dd>
                <dd id="RoadGridGraph.has_predecessor" class="function">has_predecessor</dd>
                <dd id="RoadGridGraph.successors" class="function">successors</dd>
                <dd id="RoadGridGraph.neighbors" class="function">neighbors</dd>
                <dd id="RoadGridGraph.predecessors" class="function">predecessors</dd>
                <dd id="RoadGridGraph.edges" class="variable">edges</dd>
                <dd id="RoadGridGraph.out_edges" class="variable">out_edges</dd>
                <dd id="RoadGridGraph.in_edges" class="variable">in_edges</dd>
                <dd id="RoadGridGraph.degree" class="variable">degree</dd>
                <dd id="RoadGridGraph.in_degree" class="variable">in_degree</dd>
                <dd id="RoadGridGraph.out_degree" class="variable">out_degree</dd>
                <dd id="RoadGridGraph.clear" class="function">clear</dd>
                <dd id="RoadGridGraph.clear_edges" class="function">clear_edges</dd>
                <dd id="RoadGridGraph.is_multigraph" class="function">is_multigraph</dd>
                <dd id="RoadGridGraph.is_directed" class="function">is_directed</dd>
                <dd id="RoadGridGraph.to_undirected" class="function">to_undirected</dd>
                <dd id="RoadGridGraph.reverse" class="function">reverse</dd>

            </div>
            <div><dt>networkx.classes.graph.Graph</dt>
                                <dd id="RoadGridGraph.node_dict_factory" class="variable">node_dict_factory</dd>
                <dd id="RoadGridGraph.node_attr_dict_factory" class="variable">node_attr_dict_factory</dd>
                <dd id="RoadGridGraph.adjlist_outer_dict_factory" class="variable">adjlist_outer_dict_factory</dd>
                <dd id="RoadGridGraph.adjlist_inner_dict_factory" class="variable">adjlist_inner_dict_factory</dd>
                <dd id="RoadGridGraph.edge_attr_dict_factory" class="variable">edge_attr_dict_factory</dd>
                <dd id="RoadGridGraph.graph_attr_dict_factory" class="variable">graph_attr_dict_factory</dd>
                <dd id="RoadGridGraph.to_directed_class" class="function">to_directed_class</dd>
                <dd id="RoadGridGraph.to_undirected_class" class="function">to_undirected_class</dd>
                <dd id="RoadGridGraph.name" class="variable">name</dd>
                <dd id="RoadGridGraph.nodes" class="variable">nodes</dd>
                <dd id="RoadGridGraph.number_of_nodes" class="function">number_of_nodes</dd>
                <dd id="RoadGridGraph.order" class="function">order</dd>
                <dd id="RoadGridGraph.has_node" class="function">has_node</dd>
                <dd id="RoadGridGraph.add_weighted_edges_from" class="function">add_weighted_edges_from</dd>
                <dd id="RoadGridGraph.update" class="function">update</dd>
                <dd id="RoadGridGraph.has_edge" class="function">has_edge</dd>
                <dd id="RoadGridGraph.get_edge_data" class="function">get_edge_data</dd>
                <dd id="RoadGridGraph.adjacency" class="function">adjacency</dd>
                <dd id="RoadGridGraph.copy" class="function">copy</dd>
                <dd id="RoadGridGraph.to_directed" class="function">to_directed</dd>
                <dd id="RoadGridGraph.subgraph" class="function">subgraph</dd>
                <dd id="RoadGridGraph.edge_subgraph" class="function">edge_subgraph</dd>
                <dd id="RoadGridGraph.size" class="function">size</dd>
                <dd id="RoadGridGraph.number_of_edges" class="function">number_of_edges</dd>
                <dd id="RoadGridGraph.nbunch_iter" class="function">nbunch_iter</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="subnode">
                            <input id="subnode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">subnode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">i</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">j</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Node">space.Node</a></span>:</span></span>

                <label class="view-source-button" for="subnode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#subnode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="subnode-190"><a href="#subnode-190"><span class="linenos">190</span></a><span class="k">def</span> <span class="nf">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
</span><span id="subnode-191"><a href="#subnode-191"><span class="linenos">191</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="subnode-192"><a href="#subnode-192"><span class="linenos">192</span></a><span class="sd">    Returns the detailed network subnode (i, j) of a coarse network node.</span>
</span><span id="subnode-193"><a href="#subnode-193"><span class="linenos">193</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="subnode-194"><a href="#subnode-194"><span class="linenos">194</span></a>    <span class="k">return</span> <span class="n">Node</span><span class="p">((</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns the detailed network subnode (i, j) of a coarse network node.</p>
</div>


                </section>
                <section id="RoadNetworkGrid">
                            <input id="RoadNetworkGrid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@configurable</div>

    <span class="def">class</span>
    <span class="name">RoadNetworkGrid</span><wbr>(<span class="base"><a href="core.html#Space">core.Space</a></span>):

                <label class="view-source-button" for="RoadNetworkGrid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid-196"><a href="#RoadNetworkGrid-196"><span class="linenos">196</span></a><span class="nd">@configurable</span>
</span><span id="RoadNetworkGrid-197"><a href="#RoadNetworkGrid-197"><span class="linenos">197</span></a><span class="k">class</span> <span class="nc">RoadNetworkGrid</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Space</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-198"><a href="#RoadNetworkGrid-198"><span class="linenos">198</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-199"><a href="#RoadNetworkGrid-199"><span class="linenos">199</span></a><span class="sd">    An agent space consisting of a road network which is placed on a grid.</span>
</span><span id="RoadNetworkGrid-200"><a href="#RoadNetworkGrid-200"><span class="linenos">200</span></a><span class="sd">    The road network is a networkx graph, where node names are tuples (x, y) referring to grid positions.</span>
</span><span id="RoadNetworkGrid-201"><a href="#RoadNetworkGrid-201"><span class="linenos">201</span></a><span class="sd">    Some nodes in the road networks can be destinations, where places of interest can be placed.</span>
</span><span id="RoadNetworkGrid-202"><a href="#RoadNetworkGrid-202"><span class="linenos">202</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-203"><a href="#RoadNetworkGrid-203"><span class="linenos">203</span></a>    <span class="n">width</span><span class="p">:</span>                  <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span>   <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;number of grid cells in x dimension&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">10</span>  
</span><span id="RoadNetworkGrid-204"><a href="#RoadNetworkGrid-204"><span class="linenos">204</span></a>    <span class="n">height</span><span class="p">:</span>                 <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span>   <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;number of grid cells in y dimension&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">10</span>   
</span><span id="RoadNetworkGrid-205"><a href="#RoadNetworkGrid-205"><span class="linenos">205</span></a>    <span class="n">road_density</span><span class="p">:</span>           <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;the proportion of the grid to be covered by roads&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="RoadNetworkGrid-206"><a href="#RoadNetworkGrid-206"><span class="linenos">206</span></a>    <span class="n">destination_density</span><span class="p">:</span>    <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;probability of generating a destination in a position where it is possible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span> 
</span><span id="RoadNetworkGrid-207"><a href="#RoadNetworkGrid-207"><span class="linenos">207</span></a>    <span class="n">charging_point_density</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;Param&quot;</span><span class="p">,</span> <span class="s2">&quot;probability of a destination having a charging point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="RoadNetworkGrid-208"><a href="#RoadNetworkGrid-208"><span class="linenos">208</span></a>
</span><span id="RoadNetworkGrid-209"><a href="#RoadNetworkGrid-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-210"><a href="#RoadNetworkGrid-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-211"><a href="#RoadNetworkGrid-211"><span class="linenos">211</span></a><span class="sd">        Creates a grid of size (width, height), and adds a road network to it.</span>
</span><span id="RoadNetworkGrid-212"><a href="#RoadNetworkGrid-212"><span class="linenos">212</span></a><span class="sd">        </span>
</span><span id="RoadNetworkGrid-213"><a href="#RoadNetworkGrid-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-214"><a href="#RoadNetworkGrid-214"><span class="linenos">214</span></a><span class="sd">            configuration (Configuration): the configuration of parameters from which the road network is generated.</span>
</span><span id="RoadNetworkGrid-215"><a href="#RoadNetworkGrid-215"><span class="linenos">215</span></a><span class="sd">            model (core.Model): the model of which this space is to be a part.</span>
</span><span id="RoadNetworkGrid-216"><a href="#RoadNetworkGrid-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-217"><a href="#RoadNetworkGrid-217"><span class="linenos">217</span></a>        <span class="c1"># Setup parameters and superclass</span>
</span><span id="RoadNetworkGrid-218"><a href="#RoadNetworkGrid-218"><span class="linenos">218</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="RoadNetworkGrid-219"><a href="#RoadNetworkGrid-219"><span class="linenos">219</span></a>        <span class="n">configuration</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-220"><a href="#RoadNetworkGrid-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="RoadNetworkGrid-221"><a href="#RoadNetworkGrid-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-222"><a href="#RoadNetworkGrid-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-223"><a href="#RoadNetworkGrid-223"><span class="linenos">223</span></a>
</span><span id="RoadNetworkGrid-224"><a href="#RoadNetworkGrid-224"><span class="linenos">224</span></a>        <span class="c1"># Generate roads and destinations</span>
</span><span id="RoadNetworkGrid-225"><a href="#RoadNetworkGrid-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_roads</span><span class="p">()</span>
</span><span id="RoadNetworkGrid-226"><a href="#RoadNetworkGrid-226"><span class="linenos">226</span></a>
</span><span id="RoadNetworkGrid-227"><a href="#RoadNetworkGrid-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-228"><a href="#RoadNetworkGrid-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-229"><a href="#RoadNetworkGrid-229"><span class="linenos">229</span></a><span class="sd">        Creates a copy of the space, where the road network is a subgraph of the complete network, only containing the given nodes.</span>
</span><span id="RoadNetworkGrid-230"><a href="#RoadNetworkGrid-230"><span class="linenos">230</span></a>
</span><span id="RoadNetworkGrid-231"><a href="#RoadNetworkGrid-231"><span class="linenos">231</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-232"><a href="#RoadNetworkGrid-232"><span class="linenos">232</span></a><span class="sd">            nodes (list[Node]): the nodes to be included in the subgraph.</span>
</span><span id="RoadNetworkGrid-233"><a href="#RoadNetworkGrid-233"><span class="linenos">233</span></a>
</span><span id="RoadNetworkGrid-234"><a href="#RoadNetworkGrid-234"><span class="linenos">234</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-235"><a href="#RoadNetworkGrid-235"><span class="linenos">235</span></a><span class="sd">            Self: the subgraph space.</span>
</span><span id="RoadNetworkGrid-236"><a href="#RoadNetworkGrid-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-237"><a href="#RoadNetworkGrid-237"><span class="linenos">237</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-238"><a href="#RoadNetworkGrid-238"><span class="linenos">238</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">subgraph_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">filter_node</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-239"><a href="#RoadNetworkGrid-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="RoadNetworkGrid-240"><a href="#RoadNetworkGrid-240"><span class="linenos">240</span></a>
</span><span id="RoadNetworkGrid-241"><a href="#RoadNetworkGrid-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">generate_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-242"><a href="#RoadNetworkGrid-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-243"><a href="#RoadNetworkGrid-243"><span class="linenos">243</span></a><span class="sd">        Generates the road network. This is a two step process.</span>
</span><span id="RoadNetworkGrid-244"><a href="#RoadNetworkGrid-244"><span class="linenos">244</span></a><span class="sd">        First, a coarse undirected network is generated, where each node corresponds to a grid cell.</span>
</span><span id="RoadNetworkGrid-245"><a href="#RoadNetworkGrid-245"><span class="linenos">245</span></a><span class="sd">        Heustistics are used to try to spread this network over the grid and have a balance between dense and sprawling roads.</span>
</span><span id="RoadNetworkGrid-246"><a href="#RoadNetworkGrid-246"><span class="linenos">246</span></a><span class="sd">        Second, this network is expanded into a directed graph, containing separate roadways and roundabouts.</span>
</span><span id="RoadNetworkGrid-247"><a href="#RoadNetworkGrid-247"><span class="linenos">247</span></a><span class="sd">        This is achieved by dividing each coarse network node / grid cell into 4 x 4 subnodes.</span>
</span><span id="RoadNetworkGrid-248"><a href="#RoadNetworkGrid-248"><span class="linenos">248</span></a><span class="sd">        These are connected so that traffic in all directions become possible.</span>
</span><span id="RoadNetworkGrid-249"><a href="#RoadNetworkGrid-249"><span class="linenos">249</span></a><span class="sd">        In the resulting directed network, each node has either one or two outgoing edges.</span>
</span><span id="RoadNetworkGrid-250"><a href="#RoadNetworkGrid-250"><span class="linenos">250</span></a><span class="sd">        The network keeps track of what agents are currently in a node.</span>
</span><span id="RoadNetworkGrid-251"><a href="#RoadNetworkGrid-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-252"><a href="#RoadNetworkGrid-252"><span class="linenos">252</span></a>        <span class="n">cnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-253"><a href="#RoadNetworkGrid-253"><span class="linenos">253</span></a>
</span><span id="RoadNetworkGrid-254"><a href="#RoadNetworkGrid-254"><span class="linenos">254</span></a>        <span class="c1"># Step 1. Create a connected graph whose nodes are a subset of the grid cells.</span>
</span><span id="RoadNetworkGrid-255"><a href="#RoadNetworkGrid-255"><span class="linenos">255</span></a>        <span class="n">start_node</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span><span class="mi">2</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-256"><a href="#RoadNetworkGrid-256"><span class="linenos">256</span></a>        <span class="n">edge_candidates</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">start_node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">start_node</span><span class="p">)</span> <span class="p">}</span>
</span><span id="RoadNetworkGrid-257"><a href="#RoadNetworkGrid-257"><span class="linenos">257</span></a>
</span><span id="RoadNetworkGrid-258"><a href="#RoadNetworkGrid-258"><span class="linenos">258</span></a>        <span class="c1"># The number of nodes is determined by the road_density parameter.</span>
</span><span id="RoadNetworkGrid-259"><a href="#RoadNetworkGrid-259"><span class="linenos">259</span></a>        <span class="n">remaining_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_density</span>
</span><span id="RoadNetworkGrid-260"><a href="#RoadNetworkGrid-260"><span class="linenos">260</span></a>        <span class="k">while</span> <span class="n">remaining_nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-261"><a href="#RoadNetworkGrid-261"><span class="linenos">261</span></a>            <span class="c1"># Pick an edge to add, removing it from the candidates and adding it to the graph</span>
</span><span id="RoadNetworkGrid-262"><a href="#RoadNetworkGrid-262"><span class="linenos">262</span></a>            <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_candidates</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">edge_candidates</span><span class="o">.</span><span class="n">items</span><span class="p">()])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-263"><a href="#RoadNetworkGrid-263"><span class="linenos">263</span></a>
</span><span id="RoadNetworkGrid-264"><a href="#RoadNetworkGrid-264"><span class="linenos">264</span></a>            <span class="c1"># If the sink of the new edge is new in the graph, add edges to its neighbors as new edge candidates</span>
</span><span id="RoadNetworkGrid-265"><a href="#RoadNetworkGrid-265"><span class="linenos">265</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">sink</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-266"><a href="#RoadNetworkGrid-266"><span class="linenos">266</span></a>                <span class="n">new_edge_candidates</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">sink</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span> <span class="p">}</span>
</span><span id="RoadNetworkGrid-267"><a href="#RoadNetworkGrid-267"><span class="linenos">267</span></a>                <span class="n">edge_candidates</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_edge_candidates</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-268"><a href="#RoadNetworkGrid-268"><span class="linenos">268</span></a>
</span><span id="RoadNetworkGrid-269"><a href="#RoadNetworkGrid-269"><span class="linenos">269</span></a>            <span class="c1"># Add the new edge (and implicitly its nodes), and remove the edge as a candidate.</span>
</span><span id="RoadNetworkGrid-270"><a href="#RoadNetworkGrid-270"><span class="linenos">270</span></a>            <span class="n">cnw</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-271"><a href="#RoadNetworkGrid-271"><span class="linenos">271</span></a>            <span class="n">remaining_nodes</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="RoadNetworkGrid-272"><a href="#RoadNetworkGrid-272"><span class="linenos">272</span></a>            <span class="k">del</span> <span class="n">edge_candidates</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid-273"><a href="#RoadNetworkGrid-273"><span class="linenos">273</span></a>
</span><span id="RoadNetworkGrid-274"><a href="#RoadNetworkGrid-274"><span class="linenos">274</span></a>            <span class="c1"># Update the edge preferences for all connections to neighbours of source and sink</span>
</span><span id="RoadNetworkGrid-275"><a href="#RoadNetworkGrid-275"><span class="linenos">275</span></a>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-276"><a href="#RoadNetworkGrid-276"><span class="linenos">276</span></a>                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-277"><a href="#RoadNetworkGrid-277"><span class="linenos">277</span></a>                    <span class="n">edge_candidates</span><span class="p">[(</span><span class="n">node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span>
</span><span id="RoadNetworkGrid-278"><a href="#RoadNetworkGrid-278"><span class="linenos">278</span></a>
</span><span id="RoadNetworkGrid-279"><a href="#RoadNetworkGrid-279"><span class="linenos">279</span></a>        <span class="c1"># Step 2. Add lanes and roundabouts.</span>
</span><span id="RoadNetworkGrid-280"><a href="#RoadNetworkGrid-280"><span class="linenos">280</span></a>        <span class="c1"># Create a new graph, this time directed. Each node in the coarse graph maps to 4 x 4 nodes in the new graph.</span>
</span><span id="RoadNetworkGrid-281"><a href="#RoadNetworkGrid-281"><span class="linenos">281</span></a>        <span class="n">rnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-282"><a href="#RoadNetworkGrid-282"><span class="linenos">282</span></a>
</span><span id="RoadNetworkGrid-283"><a href="#RoadNetworkGrid-283"><span class="linenos">283</span></a>        <span class="c1"># Main directions as letters to improve readability.</span>
</span><span id="RoadNetworkGrid-284"><a href="#RoadNetworkGrid-284"><span class="linenos">284</span></a>        <span class="n">N</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-285"><a href="#RoadNetworkGrid-285"><span class="linenos">285</span></a>
</span><span id="RoadNetworkGrid-286"><a href="#RoadNetworkGrid-286"><span class="linenos">286</span></a>        <span class="c1"># Add internal connections between coarse node in detailed graph.</span>
</span><span id="RoadNetworkGrid-287"><a href="#RoadNetworkGrid-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cnw</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-288"><a href="#RoadNetworkGrid-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-289"><a href="#RoadNetworkGrid-289"><span class="linenos">289</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-290"><a href="#RoadNetworkGrid-290"><span class="linenos">290</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-291"><a href="#RoadNetworkGrid-291"><span class="linenos">291</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-292"><a href="#RoadNetworkGrid-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-293"><a href="#RoadNetworkGrid-293"><span class="linenos">293</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-294"><a href="#RoadNetworkGrid-294"><span class="linenos">294</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-295"><a href="#RoadNetworkGrid-295"><span class="linenos">295</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-296"><a href="#RoadNetworkGrid-296"><span class="linenos">296</span></a>
</span><span id="RoadNetworkGrid-297"><a href="#RoadNetworkGrid-297"><span class="linenos">297</span></a>        <span class="c1"># Add connections for roundabouts and through roads</span>
</span><span id="RoadNetworkGrid-298"><a href="#RoadNetworkGrid-298"><span class="linenos">298</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cnw</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-299"><a href="#RoadNetworkGrid-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-300"><a href="#RoadNetworkGrid-300"><span class="linenos">300</span></a>                <span class="c1"># Dead ends need to make it possible to turn around, which requires adding three out of four edges.</span>
</span><span id="RoadNetworkGrid-301"><a href="#RoadNetworkGrid-301"><span class="linenos">301</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-302"><a href="#RoadNetworkGrid-302"><span class="linenos">302</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-303"><a href="#RoadNetworkGrid-303"><span class="linenos">303</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-304"><a href="#RoadNetworkGrid-304"><span class="linenos">304</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-305"><a href="#RoadNetworkGrid-305"><span class="linenos">305</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-306"><a href="#RoadNetworkGrid-306"><span class="linenos">306</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-307"><a href="#RoadNetworkGrid-307"><span class="linenos">307</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-308"><a href="#RoadNetworkGrid-308"><span class="linenos">308</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-309"><a href="#RoadNetworkGrid-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-310"><a href="#RoadNetworkGrid-310"><span class="linenos">310</span></a>                <span class="c1"># Through roads</span>
</span><span id="RoadNetworkGrid-311"><a href="#RoadNetworkGrid-311"><span class="linenos">311</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-312"><a href="#RoadNetworkGrid-312"><span class="linenos">312</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-313"><a href="#RoadNetworkGrid-313"><span class="linenos">313</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-314"><a href="#RoadNetworkGrid-314"><span class="linenos">314</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-315"><a href="#RoadNetworkGrid-315"><span class="linenos">315</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-316"><a href="#RoadNetworkGrid-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-317"><a href="#RoadNetworkGrid-317"><span class="linenos">317</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-318"><a href="#RoadNetworkGrid-318"><span class="linenos">318</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-319"><a href="#RoadNetworkGrid-319"><span class="linenos">319</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-320"><a href="#RoadNetworkGrid-320"><span class="linenos">320</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-321"><a href="#RoadNetworkGrid-321"><span class="linenos">321</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-322"><a href="#RoadNetworkGrid-322"><span class="linenos">322</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-323"><a href="#RoadNetworkGrid-323"><span class="linenos">323</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-324"><a href="#RoadNetworkGrid-324"><span class="linenos">324</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-325"><a href="#RoadNetworkGrid-325"><span class="linenos">325</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-326"><a href="#RoadNetworkGrid-326"><span class="linenos">326</span></a>                <span class="c1"># # Three and four way crossings require roundabouts, so all four edges are added.</span>
</span><span id="RoadNetworkGrid-327"><a href="#RoadNetworkGrid-327"><span class="linenos">327</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid-328"><a href="#RoadNetworkGrid-328"><span class="linenos">328</span></a>
</span><span id="RoadNetworkGrid-329"><a href="#RoadNetworkGrid-329"><span class="linenos">329</span></a>        <span class="c1"># Add one destination to all road nodes that have a free grid neighbor. </span>
</span><span id="RoadNetworkGrid-330"><a href="#RoadNetworkGrid-330"><span class="linenos">330</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rnw</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-331"><a href="#RoadNetworkGrid-331"><span class="linenos">331</span></a>            <span class="k">if</span> <span class="n">rnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-332"><a href="#RoadNetworkGrid-332"><span class="linenos">332</span></a>                <span class="k">for</span> <span class="n">destination</span> <span class="ow">in</span> <span class="n">rnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span> 
</span><span id="RoadNetworkGrid-333"><a href="#RoadNetworkGrid-333"><span class="linenos">333</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-334"><a href="#RoadNetworkGrid-334"><span class="linenos">334</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_density</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-335"><a href="#RoadNetworkGrid-335"><span class="linenos">335</span></a>                            <span class="n">charging_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">charging_point_density</span>
</span><span id="RoadNetworkGrid-336"><a href="#RoadNetworkGrid-336"><span class="linenos">336</span></a>                            <span class="n">rnw</span><span class="o">.</span><span class="n">add_destination</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">charging_point</span> <span class="o">=</span> <span class="n">charging_point</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-337"><a href="#RoadNetworkGrid-337"><span class="linenos">337</span></a>                            <span class="k">break</span>
</span><span id="RoadNetworkGrid-338"><a href="#RoadNetworkGrid-338"><span class="linenos">338</span></a>
</span><span id="RoadNetworkGrid-339"><a href="#RoadNetworkGrid-339"><span class="linenos">339</span></a>    <span class="k">def</span> <span class="nf">_edge_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="n">Edge</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-340"><a href="#RoadNetworkGrid-340"><span class="linenos">340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-341"><a href="#RoadNetworkGrid-341"><span class="linenos">341</span></a><span class="sd">        Provides a heuristic for adding edges to the coarse network during generation.</span>
</span><span id="RoadNetworkGrid-342"><a href="#RoadNetworkGrid-342"><span class="linenos">342</span></a><span class="sd">        It assigns a random preference to the provided edge depending on where it is on the grid and the connecting nodes previous edges.</span>
</span><span id="RoadNetworkGrid-343"><a href="#RoadNetworkGrid-343"><span class="linenos">343</span></a>
</span><span id="RoadNetworkGrid-344"><a href="#RoadNetworkGrid-344"><span class="linenos">344</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-345"><a href="#RoadNetworkGrid-345"><span class="linenos">345</span></a><span class="sd">            edge (Edge): the edge.</span>
</span><span id="RoadNetworkGrid-346"><a href="#RoadNetworkGrid-346"><span class="linenos">346</span></a>
</span><span id="RoadNetworkGrid-347"><a href="#RoadNetworkGrid-347"><span class="linenos">347</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-348"><a href="#RoadNetworkGrid-348"><span class="linenos">348</span></a><span class="sd">            float: a number indicating how preferred this edge is.</span>
</span><span id="RoadNetworkGrid-349"><a href="#RoadNetworkGrid-349"><span class="linenos">349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-350"><a href="#RoadNetworkGrid-350"><span class="linenos">350</span></a>        <span class="c1"># Returns a numerical value indicating how preferred this edge is (higher means more likely to be selected)</span>
</span><span id="RoadNetworkGrid-351"><a href="#RoadNetworkGrid-351"><span class="linenos">351</span></a>        <span class="n">cnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span>
</span><span id="RoadNetworkGrid-352"><a href="#RoadNetworkGrid-352"><span class="linenos">352</span></a>
</span><span id="RoadNetworkGrid-353"><a href="#RoadNetworkGrid-353"><span class="linenos">353</span></a>        <span class="c1"># Count number of existing edges for the source and sink of the selected edge</span>
</span><span id="RoadNetworkGrid-354"><a href="#RoadNetworkGrid-354"><span class="linenos">354</span></a>        <span class="n">nb_source_edges</span> <span class="o">=</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cnw</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="RoadNetworkGrid-355"><a href="#RoadNetworkGrid-355"><span class="linenos">355</span></a>        <span class="n">nb_sink_edges</span> <span class="o">=</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cnw</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="RoadNetworkGrid-356"><a href="#RoadNetworkGrid-356"><span class="linenos">356</span></a>
</span><span id="RoadNetworkGrid-357"><a href="#RoadNetworkGrid-357"><span class="linenos">357</span></a>        <span class="c1"># Count distance of sink from center of world normalized with respect to the size of the world</span>
</span><span id="RoadNetworkGrid-358"><a href="#RoadNetworkGrid-358"><span class="linenos">358</span></a>        <span class="n">dist_x</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="RoadNetworkGrid-359"><a href="#RoadNetworkGrid-359"><span class="linenos">359</span></a>        <span class="n">dist_y</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="RoadNetworkGrid-360"><a href="#RoadNetworkGrid-360"><span class="linenos">360</span></a>        <span class="n">norm_dist</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist_x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">dist_y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-361"><a href="#RoadNetworkGrid-361"><span class="linenos">361</span></a>
</span><span id="RoadNetworkGrid-362"><a href="#RoadNetworkGrid-362"><span class="linenos">362</span></a>        <span class="c1"># Prefer adding edges away from the center and adding new nodes (a small epsilon is added to ensure that weights &gt; 0)</span>
</span><span id="RoadNetworkGrid-363"><a href="#RoadNetworkGrid-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">norm_dist</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb_source_edges</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">nb_sink_edges</span> <span class="o">+</span> <span class="mf">0.00001</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-364"><a href="#RoadNetworkGrid-364"><span class="linenos">364</span></a>        
</span><span id="RoadNetworkGrid-365"><a href="#RoadNetworkGrid-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">priority_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">to_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-366"><a href="#RoadNetworkGrid-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-367"><a href="#RoadNetworkGrid-367"><span class="linenos">367</span></a><span class="sd">        Returns the nodes from which traffic has priority over from_node when going into to_node.</span>
</span><span id="RoadNetworkGrid-368"><a href="#RoadNetworkGrid-368"><span class="linenos">368</span></a><span class="sd">        This is traffic coming from the left in a roundabout, and any traffic when leaving a parking.</span>
</span><span id="RoadNetworkGrid-369"><a href="#RoadNetworkGrid-369"><span class="linenos">369</span></a>
</span><span id="RoadNetworkGrid-370"><a href="#RoadNetworkGrid-370"><span class="linenos">370</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-371"><a href="#RoadNetworkGrid-371"><span class="linenos">371</span></a><span class="sd">            from_node (Node): the node to be checked for priority.</span>
</span><span id="RoadNetworkGrid-372"><a href="#RoadNetworkGrid-372"><span class="linenos">372</span></a><span class="sd">            to_node (Node): the node to be checked for priority.</span>
</span><span id="RoadNetworkGrid-373"><a href="#RoadNetworkGrid-373"><span class="linenos">373</span></a>
</span><span id="RoadNetworkGrid-374"><a href="#RoadNetworkGrid-374"><span class="linenos">374</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-375"><a href="#RoadNetworkGrid-375"><span class="linenos">375</span></a><span class="sd">            list[Node]: a list of nodes from which vehicles have priority.</span>
</span><span id="RoadNetworkGrid-376"><a href="#RoadNetworkGrid-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-377"><a href="#RoadNetworkGrid-377"><span class="linenos">377</span></a>        <span class="n">rnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span>
</span><span id="RoadNetworkGrid-378"><a href="#RoadNetworkGrid-378"><span class="linenos">378</span></a>        <span class="c1"># Determine which node has priority entering to_node.</span>
</span><span id="RoadNetworkGrid-379"><a href="#RoadNetworkGrid-379"><span class="linenos">379</span></a>
</span><span id="RoadNetworkGrid-380"><a href="#RoadNetworkGrid-380"><span class="linenos">380</span></a>        <span class="c1"># If from_node is a destination, all other nodes going into to_node have priority.</span>
</span><span id="RoadNetworkGrid-381"><a href="#RoadNetworkGrid-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">from_node</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-382"><a href="#RoadNetworkGrid-382"><span class="linenos">382</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">roads_to</span><span class="p">(</span><span class="n">to_node</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="o">!=</span> <span class="n">from_node</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-383"><a href="#RoadNetworkGrid-383"><span class="linenos">383</span></a>
</span><span id="RoadNetworkGrid-384"><a href="#RoadNetworkGrid-384"><span class="linenos">384</span></a>        <span class="c1"># In a roundabout, a vehicle going S yields to one going W, E to S, N to E, and W to N.</span>
</span><span id="RoadNetworkGrid-385"><a href="#RoadNetworkGrid-385"><span class="linenos">385</span></a>        <span class="n">priority_rule</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">180</span> <span class="p">:</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">90</span> <span class="p">:</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">0</span> <span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">270</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
</span><span id="RoadNetworkGrid-386"><a href="#RoadNetworkGrid-386"><span class="linenos">386</span></a>        <span class="n">priority_direction</span> <span class="o">=</span> <span class="n">priority_rule</span><span class="p">[</span><span class="n">rnw</span><span class="p">[</span><span class="n">from_node</span><span class="p">][</span><span class="n">to_node</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]]</span>
</span><span id="RoadNetworkGrid-387"><a href="#RoadNetworkGrid-387"><span class="linenos">387</span></a>        <span class="n">priority_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">rnw</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">to_node</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;direction&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">priority_direction</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-388"><a href="#RoadNetworkGrid-388"><span class="linenos">388</span></a>
</span><span id="RoadNetworkGrid-389"><a href="#RoadNetworkGrid-389"><span class="linenos">389</span></a>        <span class="c1"># If the priority node can reach to_node, return it, otherwise return nothing.</span>
</span><span id="RoadNetworkGrid-390"><a href="#RoadNetworkGrid-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="n">priority_nodes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">to_node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="RoadNetworkGrid-391"><a href="#RoadNetworkGrid-391"><span class="linenos">391</span></a>            <span class="k">return</span> <span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-392"><a href="#RoadNetworkGrid-392"><span class="linenos">392</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-393"><a href="#RoadNetworkGrid-393"><span class="linenos">393</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="RoadNetworkGrid-394"><a href="#RoadNetworkGrid-394"><span class="linenos">394</span></a>
</span><span id="RoadNetworkGrid-395"><a href="#RoadNetworkGrid-395"><span class="linenos">395</span></a>    <span class="k">def</span> <span class="nf">road_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-396"><a href="#RoadNetworkGrid-396"><span class="linenos">396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-397"><a href="#RoadNetworkGrid-397"><span class="linenos">397</span></a><span class="sd">        Returns a list of all nodes which are connected by roads.</span>
</span><span id="RoadNetworkGrid-398"><a href="#RoadNetworkGrid-398"><span class="linenos">398</span></a>
</span><span id="RoadNetworkGrid-399"><a href="#RoadNetworkGrid-399"><span class="linenos">399</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-400"><a href="#RoadNetworkGrid-400"><span class="linenos">400</span></a><span class="sd">            condition: a condition that the nodes must satisfy. Defaults to always True.</span>
</span><span id="RoadNetworkGrid-401"><a href="#RoadNetworkGrid-401"><span class="linenos">401</span></a>
</span><span id="RoadNetworkGrid-402"><a href="#RoadNetworkGrid-402"><span class="linenos">402</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-403"><a href="#RoadNetworkGrid-403"><span class="linenos">403</span></a><span class="sd">            list[Node]: the nodes connected by roads.</span>
</span><span id="RoadNetworkGrid-404"><a href="#RoadNetworkGrid-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-405"><a href="#RoadNetworkGrid-405"><span class="linenos">405</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid-406"><a href="#RoadNetworkGrid-406"><span class="linenos">406</span></a>
</span><span id="RoadNetworkGrid-407"><a href="#RoadNetworkGrid-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">destination_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-408"><a href="#RoadNetworkGrid-408"><span class="linenos">408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-409"><a href="#RoadNetworkGrid-409"><span class="linenos">409</span></a><span class="sd">        Returns a list of all nodes which are destinations.</span>
</span><span id="RoadNetworkGrid-410"><a href="#RoadNetworkGrid-410"><span class="linenos">410</span></a>
</span><span id="RoadNetworkGrid-411"><a href="#RoadNetworkGrid-411"><span class="linenos">411</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-412"><a href="#RoadNetworkGrid-412"><span class="linenos">412</span></a><span class="sd">            condition: a condition that the nodes must satisfy. Defaults to always True.</span>
</span><span id="RoadNetworkGrid-413"><a href="#RoadNetworkGrid-413"><span class="linenos">413</span></a>
</span><span id="RoadNetworkGrid-414"><a href="#RoadNetworkGrid-414"><span class="linenos">414</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-415"><a href="#RoadNetworkGrid-415"><span class="linenos">415</span></a><span class="sd">            list[Node]: the destinations.</span>
</span><span id="RoadNetworkGrid-416"><a href="#RoadNetworkGrid-416"><span class="linenos">416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-417"><a href="#RoadNetworkGrid-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid-418"><a href="#RoadNetworkGrid-418"><span class="linenos">418</span></a>
</span><span id="RoadNetworkGrid-419"><a href="#RoadNetworkGrid-419"><span class="linenos">419</span></a>    <span class="k">def</span> <span class="nf">road_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Edge</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-420"><a href="#RoadNetworkGrid-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-421"><a href="#RoadNetworkGrid-421"><span class="linenos">421</span></a><span class="sd">        Returns a list of all edges that are roads.</span>
</span><span id="RoadNetworkGrid-422"><a href="#RoadNetworkGrid-422"><span class="linenos">422</span></a>
</span><span id="RoadNetworkGrid-423"><a href="#RoadNetworkGrid-423"><span class="linenos">423</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-424"><a href="#RoadNetworkGrid-424"><span class="linenos">424</span></a><span class="sd">            list[Node]: the nodes connected by roads.</span>
</span><span id="RoadNetworkGrid-425"><a href="#RoadNetworkGrid-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-426"><a href="#RoadNetworkGrid-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">Edge</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">edges</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid-427"><a href="#RoadNetworkGrid-427"><span class="linenos">427</span></a>
</span><span id="RoadNetworkGrid-428"><a href="#RoadNetworkGrid-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">roads_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span> <span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-429"><a href="#RoadNetworkGrid-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-430"><a href="#RoadNetworkGrid-430"><span class="linenos">430</span></a><span class="sd">        Returns a list of all nodes that can be reached by road from a given source node.</span>
</span><span id="RoadNetworkGrid-431"><a href="#RoadNetworkGrid-431"><span class="linenos">431</span></a><span class="sd">        If a condition function is provided, only nodes fulfilling that condition are returned.</span>
</span><span id="RoadNetworkGrid-432"><a href="#RoadNetworkGrid-432"><span class="linenos">432</span></a>
</span><span id="RoadNetworkGrid-433"><a href="#RoadNetworkGrid-433"><span class="linenos">433</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-434"><a href="#RoadNetworkGrid-434"><span class="linenos">434</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadNetworkGrid-435"><a href="#RoadNetworkGrid-435"><span class="linenos">435</span></a><span class="sd">            condition (Callable[[Node], bool], optional): a condition on the nodes. Defaults to always True.</span>
</span><span id="RoadNetworkGrid-436"><a href="#RoadNetworkGrid-436"><span class="linenos">436</span></a><span class="sd">            </span>
</span><span id="RoadNetworkGrid-437"><a href="#RoadNetworkGrid-437"><span class="linenos">437</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-438"><a href="#RoadNetworkGrid-438"><span class="linenos">438</span></a><span class="sd">            list[Node]: a list of nodes reachable by road.</span>
</span><span id="RoadNetworkGrid-439"><a href="#RoadNetworkGrid-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-440"><a href="#RoadNetworkGrid-440"><span class="linenos">440</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">sink</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">sink</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid-441"><a href="#RoadNetworkGrid-441"><span class="linenos">441</span></a>
</span><span id="RoadNetworkGrid-442"><a href="#RoadNetworkGrid-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">roads_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span> <span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-443"><a href="#RoadNetworkGrid-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-444"><a href="#RoadNetworkGrid-444"><span class="linenos">444</span></a><span class="sd">        Returns a list of all nodes that can reach the given sink node by road.</span>
</span><span id="RoadNetworkGrid-445"><a href="#RoadNetworkGrid-445"><span class="linenos">445</span></a><span class="sd">        If a condition function is provided, only nodes fulfilling that condition are returned.</span>
</span><span id="RoadNetworkGrid-446"><a href="#RoadNetworkGrid-446"><span class="linenos">446</span></a>
</span><span id="RoadNetworkGrid-447"><a href="#RoadNetworkGrid-447"><span class="linenos">447</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-448"><a href="#RoadNetworkGrid-448"><span class="linenos">448</span></a><span class="sd">            sink (Node): the sink node.</span>
</span><span id="RoadNetworkGrid-449"><a href="#RoadNetworkGrid-449"><span class="linenos">449</span></a><span class="sd">            condition (Callable[[Node], bool], optional): a condition on the nodes. Defaults to always True.</span>
</span><span id="RoadNetworkGrid-450"><a href="#RoadNetworkGrid-450"><span class="linenos">450</span></a>
</span><span id="RoadNetworkGrid-451"><a href="#RoadNetworkGrid-451"><span class="linenos">451</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-452"><a href="#RoadNetworkGrid-452"><span class="linenos">452</span></a><span class="sd">            list[Node]: a list of nodes from which the sink node can be reached by road.</span>
</span><span id="RoadNetworkGrid-453"><a href="#RoadNetworkGrid-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-454"><a href="#RoadNetworkGrid-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">source</span> <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">source</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid-455"><a href="#RoadNetworkGrid-455"><span class="linenos">455</span></a>
</span><span id="RoadNetworkGrid-456"><a href="#RoadNetworkGrid-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">is_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-457"><a href="#RoadNetworkGrid-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-458"><a href="#RoadNetworkGrid-458"><span class="linenos">458</span></a><span class="sd">        Checks if a node is a destination.</span>
</span><span id="RoadNetworkGrid-459"><a href="#RoadNetworkGrid-459"><span class="linenos">459</span></a>
</span><span id="RoadNetworkGrid-460"><a href="#RoadNetworkGrid-460"><span class="linenos">460</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-461"><a href="#RoadNetworkGrid-461"><span class="linenos">461</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadNetworkGrid-462"><a href="#RoadNetworkGrid-462"><span class="linenos">462</span></a>
</span><span id="RoadNetworkGrid-463"><a href="#RoadNetworkGrid-463"><span class="linenos">463</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-464"><a href="#RoadNetworkGrid-464"><span class="linenos">464</span></a><span class="sd">            bool: True if the node is a destination.</span>
</span><span id="RoadNetworkGrid-465"><a href="#RoadNetworkGrid-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-466"><a href="#RoadNetworkGrid-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-467"><a href="#RoadNetworkGrid-467"><span class="linenos">467</span></a>
</span><span id="RoadNetworkGrid-468"><a href="#RoadNetworkGrid-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">is_charging_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-469"><a href="#RoadNetworkGrid-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-470"><a href="#RoadNetworkGrid-470"><span class="linenos">470</span></a><span class="sd">        Checks if a node is a charging point.</span>
</span><span id="RoadNetworkGrid-471"><a href="#RoadNetworkGrid-471"><span class="linenos">471</span></a>
</span><span id="RoadNetworkGrid-472"><a href="#RoadNetworkGrid-472"><span class="linenos">472</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-473"><a href="#RoadNetworkGrid-473"><span class="linenos">473</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadNetworkGrid-474"><a href="#RoadNetworkGrid-474"><span class="linenos">474</span></a>
</span><span id="RoadNetworkGrid-475"><a href="#RoadNetworkGrid-475"><span class="linenos">475</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-476"><a href="#RoadNetworkGrid-476"><span class="linenos">476</span></a><span class="sd">            bool: True if the node is a charging point.</span>
</span><span id="RoadNetworkGrid-477"><a href="#RoadNetworkGrid-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-478"><a href="#RoadNetworkGrid-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;charging_point&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-479"><a href="#RoadNetworkGrid-479"><span class="linenos">479</span></a>
</span><span id="RoadNetworkGrid-480"><a href="#RoadNetworkGrid-480"><span class="linenos">480</span></a>    <span class="k">def</span> <span class="nf">edge_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Direction</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-481"><a href="#RoadNetworkGrid-481"><span class="linenos">481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-482"><a href="#RoadNetworkGrid-482"><span class="linenos">482</span></a><span class="sd">        Returns the direction of the edge going from source to sink.</span>
</span><span id="RoadNetworkGrid-483"><a href="#RoadNetworkGrid-483"><span class="linenos">483</span></a>
</span><span id="RoadNetworkGrid-484"><a href="#RoadNetworkGrid-484"><span class="linenos">484</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-485"><a href="#RoadNetworkGrid-485"><span class="linenos">485</span></a><span class="sd">            source (Node): source node.</span>
</span><span id="RoadNetworkGrid-486"><a href="#RoadNetworkGrid-486"><span class="linenos">486</span></a><span class="sd">            sink (Node): sink node.</span>
</span><span id="RoadNetworkGrid-487"><a href="#RoadNetworkGrid-487"><span class="linenos">487</span></a>
</span><span id="RoadNetworkGrid-488"><a href="#RoadNetworkGrid-488"><span class="linenos">488</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-489"><a href="#RoadNetworkGrid-489"><span class="linenos">489</span></a><span class="sd">            Direction: the direction in degrees.</span>
</span><span id="RoadNetworkGrid-490"><a href="#RoadNetworkGrid-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-491"><a href="#RoadNetworkGrid-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-492"><a href="#RoadNetworkGrid-492"><span class="linenos">492</span></a>
</span><span id="RoadNetworkGrid-493"><a href="#RoadNetworkGrid-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-494"><a href="#RoadNetworkGrid-494"><span class="linenos">494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-495"><a href="#RoadNetworkGrid-495"><span class="linenos">495</span></a><span class="sd">        Returns the shortest path from source to sink as a list of nodes.</span>
</span><span id="RoadNetworkGrid-496"><a href="#RoadNetworkGrid-496"><span class="linenos">496</span></a>
</span><span id="RoadNetworkGrid-497"><a href="#RoadNetworkGrid-497"><span class="linenos">497</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-498"><a href="#RoadNetworkGrid-498"><span class="linenos">498</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadNetworkGrid-499"><a href="#RoadNetworkGrid-499"><span class="linenos">499</span></a><span class="sd">            target (Node): the target node.</span>
</span><span id="RoadNetworkGrid-500"><a href="#RoadNetworkGrid-500"><span class="linenos">500</span></a>
</span><span id="RoadNetworkGrid-501"><a href="#RoadNetworkGrid-501"><span class="linenos">501</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-502"><a href="#RoadNetworkGrid-502"><span class="linenos">502</span></a><span class="sd">            list[Node]: the path.</span>
</span><span id="RoadNetworkGrid-503"><a href="#RoadNetworkGrid-503"><span class="linenos">503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-504"><a href="#RoadNetworkGrid-504"><span class="linenos">504</span></a>        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span>
</span><span id="RoadNetworkGrid-505"><a href="#RoadNetworkGrid-505"><span class="linenos">505</span></a>                                <span class="n">weight</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">10000000</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-506"><a href="#RoadNetworkGrid-506"><span class="linenos">506</span></a>
</span><span id="RoadNetworkGrid-507"><a href="#RoadNetworkGrid-507"><span class="linenos">507</span></a>    <span class="k">def</span> <span class="nf">path_to_nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-508"><a href="#RoadNetworkGrid-508"><span class="linenos">508</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-509"><a href="#RoadNetworkGrid-509"><span class="linenos">509</span></a><span class="sd">        Given a source node and a list of target nodes, return the path to the nearest of the targets.</span>
</span><span id="RoadNetworkGrid-510"><a href="#RoadNetworkGrid-510"><span class="linenos">510</span></a>
</span><span id="RoadNetworkGrid-511"><a href="#RoadNetworkGrid-511"><span class="linenos">511</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid-512"><a href="#RoadNetworkGrid-512"><span class="linenos">512</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadNetworkGrid-513"><a href="#RoadNetworkGrid-513"><span class="linenos">513</span></a><span class="sd">            targets (list[Node]): the list of target nodes.</span>
</span><span id="RoadNetworkGrid-514"><a href="#RoadNetworkGrid-514"><span class="linenos">514</span></a>
</span><span id="RoadNetworkGrid-515"><a href="#RoadNetworkGrid-515"><span class="linenos">515</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid-516"><a href="#RoadNetworkGrid-516"><span class="linenos">516</span></a><span class="sd">            list[Node]: the path to the nearest target node.</span>
</span><span id="RoadNetworkGrid-517"><a href="#RoadNetworkGrid-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-518"><a href="#RoadNetworkGrid-518"><span class="linenos">518</span></a>        <span class="n">shortest_paths</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-519"><a href="#RoadNetworkGrid-519"><span class="linenos">519</span></a>        <span class="n">shortest_paths</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="nb">len</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-520"><a href="#RoadNetworkGrid-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="n">shortest_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-521"><a href="#RoadNetworkGrid-521"><span class="linenos">521</span></a>    
</span><span id="RoadNetworkGrid-522"><a href="#RoadNetworkGrid-522"><span class="linenos">522</span></a>    <span class="c1"># Provide reference to some of the RoadGridNetwork methods directly in the space.</span>
</span><span id="RoadNetworkGrid-523"><a href="#RoadNetworkGrid-523"><span class="linenos">523</span></a>
</span><span id="RoadNetworkGrid-524"><a href="#RoadNetworkGrid-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">has_road_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-525"><a href="#RoadNetworkGrid-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-526"><a href="#RoadNetworkGrid-526"><span class="linenos">526</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="RoadNetworkGrid-527"><a href="#RoadNetworkGrid-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-528"><a href="#RoadNetworkGrid-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-529"><a href="#RoadNetworkGrid-529"><span class="linenos">529</span></a>
</span><span id="RoadNetworkGrid-530"><a href="#RoadNetworkGrid-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">is_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-531"><a href="#RoadNetworkGrid-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-532"><a href="#RoadNetworkGrid-532"><span class="linenos">532</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="RoadNetworkGrid-533"><a href="#RoadNetworkGrid-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-534"><a href="#RoadNetworkGrid-534"><span class="linenos">534</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-535"><a href="#RoadNetworkGrid-535"><span class="linenos">535</span></a>
</span><span id="RoadNetworkGrid-536"><a href="#RoadNetworkGrid-536"><span class="linenos">536</span></a>    <span class="k">def</span> <span class="nf">grid_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-537"><a href="#RoadNetworkGrid-537"><span class="linenos">537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-538"><a href="#RoadNetworkGrid-538"><span class="linenos">538</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="RoadNetworkGrid-539"><a href="#RoadNetworkGrid-539"><span class="linenos">539</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-540"><a href="#RoadNetworkGrid-540"><span class="linenos">540</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-541"><a href="#RoadNetworkGrid-541"><span class="linenos">541</span></a>
</span><span id="RoadNetworkGrid-542"><a href="#RoadNetworkGrid-542"><span class="linenos">542</span></a>    <span class="c1"># Mesa space API (adapted from mesa.space.NetworkGrid)</span>
</span><span id="RoadNetworkGrid-543"><a href="#RoadNetworkGrid-543"><span class="linenos">543</span></a>
</span><span id="RoadNetworkGrid-544"><a href="#RoadNetworkGrid-544"><span class="linenos">544</span></a>    <span class="k">def</span> <span class="nf">place_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-545"><a href="#RoadNetworkGrid-545"><span class="linenos">545</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Place an agent in a node.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-546"><a href="#RoadNetworkGrid-546"><span class="linenos">546</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-547"><a href="#RoadNetworkGrid-547"><span class="linenos">547</span></a>        <span class="n">agent</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="RoadNetworkGrid-548"><a href="#RoadNetworkGrid-548"><span class="linenos">548</span></a>        <span class="c1"># If there are other agents in the node with which the agent cannot co-exist, raise an exception</span>
</span><span id="RoadNetworkGrid-549"><a href="#RoadNetworkGrid-549"><span class="linenos">549</span></a>        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-550"><a href="#RoadNetworkGrid-550"><span class="linenos">550</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">can_coexist</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-551"><a href="#RoadNetworkGrid-551"><span class="linenos">551</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">: Agents cannot coexist: </span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-552"><a href="#RoadNetworkGrid-552"><span class="linenos">552</span></a>
</span><span id="RoadNetworkGrid-553"><a href="#RoadNetworkGrid-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">get_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-554"><a href="#RoadNetworkGrid-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all adjacent nodes within a certain radius&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-555"><a href="#RoadNetworkGrid-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-556"><a href="#RoadNetworkGrid-556"><span class="linenos">556</span></a>            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="RoadNetworkGrid-557"><a href="#RoadNetworkGrid-557"><span class="linenos">557</span></a>            <span class="k">if</span> <span class="n">include_center</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-558"><a href="#RoadNetworkGrid-558"><span class="linenos">558</span></a>                <span class="n">neighborhood</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-559"><a href="#RoadNetworkGrid-559"><span class="linenos">559</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-560"><a href="#RoadNetworkGrid-560"><span class="linenos">560</span></a>            <span class="n">neighbors_with_distance</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">single_source_shortest_path_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-561"><a href="#RoadNetworkGrid-561"><span class="linenos">561</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_center</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-562"><a href="#RoadNetworkGrid-562"><span class="linenos">562</span></a>                <span class="k">del</span> <span class="n">neighbors_with_distance</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-563"><a href="#RoadNetworkGrid-563"><span class="linenos">563</span></a>            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">neighbors_with_distance</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="RoadNetworkGrid-564"><a href="#RoadNetworkGrid-564"><span class="linenos">564</span></a>        <span class="k">return</span> <span class="n">neighborhood</span>
</span><span id="RoadNetworkGrid-565"><a href="#RoadNetworkGrid-565"><span class="linenos">565</span></a>
</span><span id="RoadNetworkGrid-566"><a href="#RoadNetworkGrid-566"><span class="linenos">566</span></a>    <span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-567"><a href="#RoadNetworkGrid-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all agents in adjacent nodes.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-568"><a href="#RoadNetworkGrid-568"><span class="linenos">568</span></a>        <span class="n">neighborhood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">include_center</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-569"><a href="#RoadNetworkGrid-569"><span class="linenos">569</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_list_contents</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-570"><a href="#RoadNetworkGrid-570"><span class="linenos">570</span></a>
</span><span id="RoadNetworkGrid-571"><a href="#RoadNetworkGrid-571"><span class="linenos">571</span></a>    <span class="k">def</span> <span class="nf">move_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-572"><a href="#RoadNetworkGrid-572"><span class="linenos">572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move an agent from its current node to a new node.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-573"><a href="#RoadNetworkGrid-573"><span class="linenos">573</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="s2">&quot;heading&quot;</span><span class="p">):</span>
</span><span id="RoadNetworkGrid-574"><a href="#RoadNetworkGrid-574"><span class="linenos">574</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">pos</span><span class="p">][</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-575"><a href="#RoadNetworkGrid-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-576"><a href="#RoadNetworkGrid-576"><span class="linenos">576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-577"><a href="#RoadNetworkGrid-577"><span class="linenos">577</span></a>
</span><span id="RoadNetworkGrid-578"><a href="#RoadNetworkGrid-578"><span class="linenos">578</span></a>    <span class="k">def</span> <span class="nf">remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-579"><a href="#RoadNetworkGrid-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the agent from the network and set its pos attribute to None.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-580"><a href="#RoadNetworkGrid-580"><span class="linenos">580</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pos</span>
</span><span id="RoadNetworkGrid-581"><a href="#RoadNetworkGrid-581"><span class="linenos">581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-582"><a href="#RoadNetworkGrid-582"><span class="linenos">582</span></a>        <span class="n">agent</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Node</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="RoadNetworkGrid-583"><a href="#RoadNetworkGrid-583"><span class="linenos">583</span></a>
</span><span id="RoadNetworkGrid-584"><a href="#RoadNetworkGrid-584"><span class="linenos">584</span></a>    <span class="k">def</span> <span class="nf">is_cell_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid-585"><a href="#RoadNetworkGrid-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a bool of the contents of a cell.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-586"><a href="#RoadNetworkGrid-586"><span class="linenos">586</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]</span>
</span><span id="RoadNetworkGrid-587"><a href="#RoadNetworkGrid-587"><span class="linenos">587</span></a>
</span><span id="RoadNetworkGrid-588"><a href="#RoadNetworkGrid-588"><span class="linenos">588</span></a>    <span class="k">def</span> <span class="nf">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-589"><a href="#RoadNetworkGrid-589"><span class="linenos">589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of the agents contained in the nodes identified</span>
</span><span id="RoadNetworkGrid-590"><a href="#RoadNetworkGrid-590"><span class="linenos">590</span></a><span class="sd">        in `cell_list`; nodes with empty content are excluded.</span>
</span><span id="RoadNetworkGrid-591"><a href="#RoadNetworkGrid-591"><span class="linenos">591</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-592"><a href="#RoadNetworkGrid-592"><span class="linenos">592</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_cell_list_contents</span><span class="p">(</span><span class="n">cell_list</span><span class="p">))</span>
</span><span id="RoadNetworkGrid-593"><a href="#RoadNetworkGrid-593"><span class="linenos">593</span></a>
</span><span id="RoadNetworkGrid-594"><a href="#RoadNetworkGrid-594"><span class="linenos">594</span></a>    <span class="k">def</span> <span class="nf">get_all_cell_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-595"><a href="#RoadNetworkGrid-595"><span class="linenos">595</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of all the agents in the network.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-596"><a href="#RoadNetworkGrid-596"><span class="linenos">596</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-597"><a href="#RoadNetworkGrid-597"><span class="linenos">597</span></a>
</span><span id="RoadNetworkGrid-598"><a href="#RoadNetworkGrid-598"><span class="linenos">598</span></a>    <span class="k">def</span> <span class="nf">iter_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid-599"><a href="#RoadNetworkGrid-599"><span class="linenos">599</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an iterator of the agents contained in the nodes identified</span>
</span><span id="RoadNetworkGrid-600"><a href="#RoadNetworkGrid-600"><span class="linenos">600</span></a><span class="sd">        in `cell_list`; nodes with empty content are excluded.</span>
</span><span id="RoadNetworkGrid-601"><a href="#RoadNetworkGrid-601"><span class="linenos">601</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid-602"><a href="#RoadNetworkGrid-602"><span class="linenos">602</span></a>        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="RoadNetworkGrid-603"><a href="#RoadNetworkGrid-603"><span class="linenos">603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span>
</span><span id="RoadNetworkGrid-604"><a href="#RoadNetworkGrid-604"><span class="linenos">604</span></a>            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">filterfalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_cell_empty</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">)</span>
</span><span id="RoadNetworkGrid-605"><a href="#RoadNetworkGrid-605"><span class="linenos">605</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>An agent space consisting of a road network which is placed on a grid.
The road network is a networkx graph, where node names are tuples (x, y) referring to grid positions.
Some nodes in the road networks can be destinations, where places of interest can be placed.</p>
</div>


                            <div id="RoadNetworkGrid.__init__" class="classattr">
                                        <input id="RoadNetworkGrid.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RoadNetworkGrid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">configuration</span><span class="p">:</span> <span class="n"><a href="configuration.html#Configuration">configuration.Configuration</a></span>, </span><span class="param"><span class="n">model</span><span class="p">:</span> <span class="n"><a href="core.html#Model">core.Model</a></span></span>)</span>

                <label class="view-source-button" for="RoadNetworkGrid.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.__init__-209"><a href="#RoadNetworkGrid.__init__-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.__init__-210"><a href="#RoadNetworkGrid.__init__-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.__init__-211"><a href="#RoadNetworkGrid.__init__-211"><span class="linenos">211</span></a><span class="sd">        Creates a grid of size (width, height), and adds a road network to it.</span>
</span><span id="RoadNetworkGrid.__init__-212"><a href="#RoadNetworkGrid.__init__-212"><span class="linenos">212</span></a><span class="sd">        </span>
</span><span id="RoadNetworkGrid.__init__-213"><a href="#RoadNetworkGrid.__init__-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.__init__-214"><a href="#RoadNetworkGrid.__init__-214"><span class="linenos">214</span></a><span class="sd">            configuration (Configuration): the configuration of parameters from which the road network is generated.</span>
</span><span id="RoadNetworkGrid.__init__-215"><a href="#RoadNetworkGrid.__init__-215"><span class="linenos">215</span></a><span class="sd">            model (core.Model): the model of which this space is to be a part.</span>
</span><span id="RoadNetworkGrid.__init__-216"><a href="#RoadNetworkGrid.__init__-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.__init__-217"><a href="#RoadNetworkGrid.__init__-217"><span class="linenos">217</span></a>        <span class="c1"># Setup parameters and superclass</span>
</span><span id="RoadNetworkGrid.__init__-218"><a href="#RoadNetworkGrid.__init__-218"><span class="linenos">218</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="RoadNetworkGrid.__init__-219"><a href="#RoadNetworkGrid.__init__-219"><span class="linenos">219</span></a>        <span class="n">configuration</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.__init__-220"><a href="#RoadNetworkGrid.__init__-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="RoadNetworkGrid.__init__-221"><a href="#RoadNetworkGrid.__init__-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.__init__-222"><a href="#RoadNetworkGrid.__init__-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.__init__-223"><a href="#RoadNetworkGrid.__init__-223"><span class="linenos">223</span></a>
</span><span id="RoadNetworkGrid.__init__-224"><a href="#RoadNetworkGrid.__init__-224"><span class="linenos">224</span></a>        <span class="c1"># Generate roads and destinations</span>
</span><span id="RoadNetworkGrid.__init__-225"><a href="#RoadNetworkGrid.__init__-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">generate_roads</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Creates a grid of size (width, height), and adds a road network to it.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>configuration (Configuration):</strong>  the configuration of parameters from which the road network is generated.</li>
<li><strong>model (<a href="core.html#Model">core.Model</a>):</strong>  the model of which this space is to be a part.</li>
</ul>
</div>


                            </div>
                            <div id="RoadNetworkGrid.width" class="classattr">
                                <div class="attr variable">
            <span class="name">width</span><span class="annotation">: typing.Annotated[int, &#39;Param&#39;, &#39;number of grid cells in x dimension&#39;]</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.width"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.height" class="classattr">
                                <div class="attr variable">
            <span class="name">height</span><span class="annotation">: typing.Annotated[int, &#39;Param&#39;, &#39;number of grid cells in y dimension&#39;]</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.height"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.road_density" class="classattr">
                                <div class="attr variable">
            <span class="name">road_density</span><span class="annotation">: typing.Annotated[float, &#39;Param&#39;, &#39;the proportion of the grid to be covered by roads&#39;]</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.road_density"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.destination_density" class="classattr">
                                <div class="attr variable">
            <span class="name">destination_density</span><span class="annotation">: typing.Annotated[float, &#39;Param&#39;, &#39;probability of generating a destination in a position where it is possible&#39;]</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.destination_density"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.charging_point_density" class="classattr">
                                <div class="attr variable">
            <span class="name">charging_point_density</span><span class="annotation">: typing.Annotated[float, &#39;Param&#39;, &#39;probability of a destination having a charging point&#39;]</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.charging_point_density"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.model"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.coarse_network" class="classattr">
                                <div class="attr variable">
            <span class="name">coarse_network</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.coarse_network"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.road_network" class="classattr">
                                <div class="attr variable">
            <span class="name">road_network</span>

        
    </div>
    <a class="headerlink" href="#RoadNetworkGrid.road_network"></a>
    
    

                            </div>
                            <div id="RoadNetworkGrid.subgraph" class="classattr">
                                        <input id="RoadNetworkGrid.subgraph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">subgraph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.subgraph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.subgraph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.subgraph-227"><a href="#RoadNetworkGrid.subgraph-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.subgraph-228"><a href="#RoadNetworkGrid.subgraph-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.subgraph-229"><a href="#RoadNetworkGrid.subgraph-229"><span class="linenos">229</span></a><span class="sd">        Creates a copy of the space, where the road network is a subgraph of the complete network, only containing the given nodes.</span>
</span><span id="RoadNetworkGrid.subgraph-230"><a href="#RoadNetworkGrid.subgraph-230"><span class="linenos">230</span></a>
</span><span id="RoadNetworkGrid.subgraph-231"><a href="#RoadNetworkGrid.subgraph-231"><span class="linenos">231</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.subgraph-232"><a href="#RoadNetworkGrid.subgraph-232"><span class="linenos">232</span></a><span class="sd">            nodes (list[Node]): the nodes to be included in the subgraph.</span>
</span><span id="RoadNetworkGrid.subgraph-233"><a href="#RoadNetworkGrid.subgraph-233"><span class="linenos">233</span></a>
</span><span id="RoadNetworkGrid.subgraph-234"><a href="#RoadNetworkGrid.subgraph-234"><span class="linenos">234</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.subgraph-235"><a href="#RoadNetworkGrid.subgraph-235"><span class="linenos">235</span></a><span class="sd">            Self: the subgraph space.</span>
</span><span id="RoadNetworkGrid.subgraph-236"><a href="#RoadNetworkGrid.subgraph-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.subgraph-237"><a href="#RoadNetworkGrid.subgraph-237"><span class="linenos">237</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.subgraph-238"><a href="#RoadNetworkGrid.subgraph-238"><span class="linenos">238</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">subgraph_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">filter_node</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.subgraph-239"><a href="#RoadNetworkGrid.subgraph-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Creates a copy of the space, where the road network is a subgraph of the complete network, only containing the given nodes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>nodes (list[Node]):</strong>  the nodes to be included in the subgraph.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Self: the subgraph space.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.generate_roads" class="classattr">
                                        <input id="RoadNetworkGrid.generate_roads-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_roads</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.generate_roads-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.generate_roads"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.generate_roads-241"><a href="#RoadNetworkGrid.generate_roads-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">generate_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-242"><a href="#RoadNetworkGrid.generate_roads-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.generate_roads-243"><a href="#RoadNetworkGrid.generate_roads-243"><span class="linenos">243</span></a><span class="sd">        Generates the road network. This is a two step process.</span>
</span><span id="RoadNetworkGrid.generate_roads-244"><a href="#RoadNetworkGrid.generate_roads-244"><span class="linenos">244</span></a><span class="sd">        First, a coarse undirected network is generated, where each node corresponds to a grid cell.</span>
</span><span id="RoadNetworkGrid.generate_roads-245"><a href="#RoadNetworkGrid.generate_roads-245"><span class="linenos">245</span></a><span class="sd">        Heustistics are used to try to spread this network over the grid and have a balance between dense and sprawling roads.</span>
</span><span id="RoadNetworkGrid.generate_roads-246"><a href="#RoadNetworkGrid.generate_roads-246"><span class="linenos">246</span></a><span class="sd">        Second, this network is expanded into a directed graph, containing separate roadways and roundabouts.</span>
</span><span id="RoadNetworkGrid.generate_roads-247"><a href="#RoadNetworkGrid.generate_roads-247"><span class="linenos">247</span></a><span class="sd">        This is achieved by dividing each coarse network node / grid cell into 4 x 4 subnodes.</span>
</span><span id="RoadNetworkGrid.generate_roads-248"><a href="#RoadNetworkGrid.generate_roads-248"><span class="linenos">248</span></a><span class="sd">        These are connected so that traffic in all directions become possible.</span>
</span><span id="RoadNetworkGrid.generate_roads-249"><a href="#RoadNetworkGrid.generate_roads-249"><span class="linenos">249</span></a><span class="sd">        In the resulting directed network, each node has either one or two outgoing edges.</span>
</span><span id="RoadNetworkGrid.generate_roads-250"><a href="#RoadNetworkGrid.generate_roads-250"><span class="linenos">250</span></a><span class="sd">        The network keeps track of what agents are currently in a node.</span>
</span><span id="RoadNetworkGrid.generate_roads-251"><a href="#RoadNetworkGrid.generate_roads-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.generate_roads-252"><a href="#RoadNetworkGrid.generate_roads-252"><span class="linenos">252</span></a>        <span class="n">cnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coarse_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-253"><a href="#RoadNetworkGrid.generate_roads-253"><span class="linenos">253</span></a>
</span><span id="RoadNetworkGrid.generate_roads-254"><a href="#RoadNetworkGrid.generate_roads-254"><span class="linenos">254</span></a>        <span class="c1"># Step 1. Create a connected graph whose nodes are a subset of the grid cells.</span>
</span><span id="RoadNetworkGrid.generate_roads-255"><a href="#RoadNetworkGrid.generate_roads-255"><span class="linenos">255</span></a>        <span class="n">start_node</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span><span class="mi">2</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-256"><a href="#RoadNetworkGrid.generate_roads-256"><span class="linenos">256</span></a>        <span class="n">edge_candidates</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">start_node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">start_node</span><span class="p">)</span> <span class="p">}</span>
</span><span id="RoadNetworkGrid.generate_roads-257"><a href="#RoadNetworkGrid.generate_roads-257"><span class="linenos">257</span></a>
</span><span id="RoadNetworkGrid.generate_roads-258"><a href="#RoadNetworkGrid.generate_roads-258"><span class="linenos">258</span></a>        <span class="c1"># The number of nodes is determined by the road_density parameter.</span>
</span><span id="RoadNetworkGrid.generate_roads-259"><a href="#RoadNetworkGrid.generate_roads-259"><span class="linenos">259</span></a>        <span class="n">remaining_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_density</span>
</span><span id="RoadNetworkGrid.generate_roads-260"><a href="#RoadNetworkGrid.generate_roads-260"><span class="linenos">260</span></a>        <span class="k">while</span> <span class="n">remaining_nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-261"><a href="#RoadNetworkGrid.generate_roads-261"><span class="linenos">261</span></a>            <span class="c1"># Pick an edge to add, removing it from the candidates and adding it to the graph</span>
</span><span id="RoadNetworkGrid.generate_roads-262"><a href="#RoadNetworkGrid.generate_roads-262"><span class="linenos">262</span></a>            <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edge_candidates</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">edge_candidates</span><span class="o">.</span><span class="n">items</span><span class="p">()])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.generate_roads-263"><a href="#RoadNetworkGrid.generate_roads-263"><span class="linenos">263</span></a>
</span><span id="RoadNetworkGrid.generate_roads-264"><a href="#RoadNetworkGrid.generate_roads-264"><span class="linenos">264</span></a>            <span class="c1"># If the sink of the new edge is new in the graph, add edges to its neighbors as new edge candidates</span>
</span><span id="RoadNetworkGrid.generate_roads-265"><a href="#RoadNetworkGrid.generate_roads-265"><span class="linenos">265</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">sink</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-266"><a href="#RoadNetworkGrid.generate_roads-266"><span class="linenos">266</span></a>                <span class="n">new_edge_candidates</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">sink</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span> <span class="p">}</span>
</span><span id="RoadNetworkGrid.generate_roads-267"><a href="#RoadNetworkGrid.generate_roads-267"><span class="linenos">267</span></a>                <span class="n">edge_candidates</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_edge_candidates</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-268"><a href="#RoadNetworkGrid.generate_roads-268"><span class="linenos">268</span></a>
</span><span id="RoadNetworkGrid.generate_roads-269"><a href="#RoadNetworkGrid.generate_roads-269"><span class="linenos">269</span></a>            <span class="c1"># Add the new edge (and implicitly its nodes), and remove the edge as a candidate.</span>
</span><span id="RoadNetworkGrid.generate_roads-270"><a href="#RoadNetworkGrid.generate_roads-270"><span class="linenos">270</span></a>            <span class="n">cnw</span><span class="o">.</span><span class="n">add_road</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-271"><a href="#RoadNetworkGrid.generate_roads-271"><span class="linenos">271</span></a>            <span class="n">remaining_nodes</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="RoadNetworkGrid.generate_roads-272"><a href="#RoadNetworkGrid.generate_roads-272"><span class="linenos">272</span></a>            <span class="k">del</span> <span class="n">edge_candidates</span><span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">)]</span>
</span><span id="RoadNetworkGrid.generate_roads-273"><a href="#RoadNetworkGrid.generate_roads-273"><span class="linenos">273</span></a>
</span><span id="RoadNetworkGrid.generate_roads-274"><a href="#RoadNetworkGrid.generate_roads-274"><span class="linenos">274</span></a>            <span class="c1"># Update the edge preferences for all connections to neighbours of source and sink</span>
</span><span id="RoadNetworkGrid.generate_roads-275"><a href="#RoadNetworkGrid.generate_roads-275"><span class="linenos">275</span></a>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.generate_roads-276"><a href="#RoadNetworkGrid.generate_roads-276"><span class="linenos">276</span></a>                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">cnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-277"><a href="#RoadNetworkGrid.generate_roads-277"><span class="linenos">277</span></a>                    <span class="n">edge_candidates</span><span class="p">[(</span><span class="n">node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_preference</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">))</span>
</span><span id="RoadNetworkGrid.generate_roads-278"><a href="#RoadNetworkGrid.generate_roads-278"><span class="linenos">278</span></a>
</span><span id="RoadNetworkGrid.generate_roads-279"><a href="#RoadNetworkGrid.generate_roads-279"><span class="linenos">279</span></a>        <span class="c1"># Step 2. Add lanes and roundabouts.</span>
</span><span id="RoadNetworkGrid.generate_roads-280"><a href="#RoadNetworkGrid.generate_roads-280"><span class="linenos">280</span></a>        <span class="c1"># Create a new graph, this time directed. Each node in the coarse graph maps to 4 x 4 nodes in the new graph.</span>
</span><span id="RoadNetworkGrid.generate_roads-281"><a href="#RoadNetworkGrid.generate_roads-281"><span class="linenos">281</span></a>        <span class="n">rnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span> <span class="o">=</span> <span class="n">RoadGridGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-282"><a href="#RoadNetworkGrid.generate_roads-282"><span class="linenos">282</span></a>
</span><span id="RoadNetworkGrid.generate_roads-283"><a href="#RoadNetworkGrid.generate_roads-283"><span class="linenos">283</span></a>        <span class="c1"># Main directions as letters to improve readability.</span>
</span><span id="RoadNetworkGrid.generate_roads-284"><a href="#RoadNetworkGrid.generate_roads-284"><span class="linenos">284</span></a>        <span class="n">N</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.generate_roads-285"><a href="#RoadNetworkGrid.generate_roads-285"><span class="linenos">285</span></a>
</span><span id="RoadNetworkGrid.generate_roads-286"><a href="#RoadNetworkGrid.generate_roads-286"><span class="linenos">286</span></a>        <span class="c1"># Add internal connections between coarse node in detailed graph.</span>
</span><span id="RoadNetworkGrid.generate_roads-287"><a href="#RoadNetworkGrid.generate_roads-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cnw</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-288"><a href="#RoadNetworkGrid.generate_roads-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-289"><a href="#RoadNetworkGrid.generate_roads-289"><span class="linenos">289</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-290"><a href="#RoadNetworkGrid.generate_roads-290"><span class="linenos">290</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-291"><a href="#RoadNetworkGrid.generate_roads-291"><span class="linenos">291</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-292"><a href="#RoadNetworkGrid.generate_roads-292"><span class="linenos">292</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-293"><a href="#RoadNetworkGrid.generate_roads-293"><span class="linenos">293</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-294"><a href="#RoadNetworkGrid.generate_roads-294"><span class="linenos">294</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-295"><a href="#RoadNetworkGrid.generate_roads-295"><span class="linenos">295</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-296"><a href="#RoadNetworkGrid.generate_roads-296"><span class="linenos">296</span></a>
</span><span id="RoadNetworkGrid.generate_roads-297"><a href="#RoadNetworkGrid.generate_roads-297"><span class="linenos">297</span></a>        <span class="c1"># Add connections for roundabouts and through roads</span>
</span><span id="RoadNetworkGrid.generate_roads-298"><a href="#RoadNetworkGrid.generate_roads-298"><span class="linenos">298</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cnw</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-299"><a href="#RoadNetworkGrid.generate_roads-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-300"><a href="#RoadNetworkGrid.generate_roads-300"><span class="linenos">300</span></a>                <span class="c1"># Dead ends need to make it possible to turn around, which requires adding three out of four edges.</span>
</span><span id="RoadNetworkGrid.generate_roads-301"><a href="#RoadNetworkGrid.generate_roads-301"><span class="linenos">301</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-302"><a href="#RoadNetworkGrid.generate_roads-302"><span class="linenos">302</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-303"><a href="#RoadNetworkGrid.generate_roads-303"><span class="linenos">303</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-304"><a href="#RoadNetworkGrid.generate_roads-304"><span class="linenos">304</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-305"><a href="#RoadNetworkGrid.generate_roads-305"><span class="linenos">305</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-306"><a href="#RoadNetworkGrid.generate_roads-306"><span class="linenos">306</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-307"><a href="#RoadNetworkGrid.generate_roads-307"><span class="linenos">307</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-308"><a href="#RoadNetworkGrid.generate_roads-308"><span class="linenos">308</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-309"><a href="#RoadNetworkGrid.generate_roads-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-310"><a href="#RoadNetworkGrid.generate_roads-310"><span class="linenos">310</span></a>                <span class="c1"># Through roads</span>
</span><span id="RoadNetworkGrid.generate_roads-311"><a href="#RoadNetworkGrid.generate_roads-311"><span class="linenos">311</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-312"><a href="#RoadNetworkGrid.generate_roads-312"><span class="linenos">312</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-313"><a href="#RoadNetworkGrid.generate_roads-313"><span class="linenos">313</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-314"><a href="#RoadNetworkGrid.generate_roads-314"><span class="linenos">314</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-315"><a href="#RoadNetworkGrid.generate_roads-315"><span class="linenos">315</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-316"><a href="#RoadNetworkGrid.generate_roads-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-317"><a href="#RoadNetworkGrid.generate_roads-317"><span class="linenos">317</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-318"><a href="#RoadNetworkGrid.generate_roads-318"><span class="linenos">318</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-319"><a href="#RoadNetworkGrid.generate_roads-319"><span class="linenos">319</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-320"><a href="#RoadNetworkGrid.generate_roads-320"><span class="linenos">320</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-321"><a href="#RoadNetworkGrid.generate_roads-321"><span class="linenos">321</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-322"><a href="#RoadNetworkGrid.generate_roads-322"><span class="linenos">322</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">E</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-323"><a href="#RoadNetworkGrid.generate_roads-323"><span class="linenos">323</span></a>                <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cnw</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-324"><a href="#RoadNetworkGrid.generate_roads-324"><span class="linenos">324</span></a>                    <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-325"><a href="#RoadNetworkGrid.generate_roads-325"><span class="linenos">325</span></a>            <span class="k">if</span> <span class="n">cnw</span><span class="o">.</span><span class="n">road_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-326"><a href="#RoadNetworkGrid.generate_roads-326"><span class="linenos">326</span></a>                <span class="c1"># # Three and four way crossings require roundabouts, so all four edges are added.</span>
</span><span id="RoadNetworkGrid.generate_roads-327"><a href="#RoadNetworkGrid.generate_roads-327"><span class="linenos">327</span></a>                <span class="n">rnw</span><span class="o">.</span><span class="n">add_roads</span><span class="p">(</span><span class="n">subnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span><span class="p">])</span>
</span><span id="RoadNetworkGrid.generate_roads-328"><a href="#RoadNetworkGrid.generate_roads-328"><span class="linenos">328</span></a>
</span><span id="RoadNetworkGrid.generate_roads-329"><a href="#RoadNetworkGrid.generate_roads-329"><span class="linenos">329</span></a>        <span class="c1"># Add one destination to all road nodes that have a free grid neighbor. </span>
</span><span id="RoadNetworkGrid.generate_roads-330"><a href="#RoadNetworkGrid.generate_roads-330"><span class="linenos">330</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rnw</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-331"><a href="#RoadNetworkGrid.generate_roads-331"><span class="linenos">331</span></a>            <span class="k">if</span> <span class="n">rnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-332"><a href="#RoadNetworkGrid.generate_roads-332"><span class="linenos">332</span></a>                <span class="k">for</span> <span class="n">destination</span> <span class="ow">in</span> <span class="n">rnw</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span> 
</span><span id="RoadNetworkGrid.generate_roads-333"><a href="#RoadNetworkGrid.generate_roads-333"><span class="linenos">333</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rnw</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.generate_roads-334"><a href="#RoadNetworkGrid.generate_roads-334"><span class="linenos">334</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_density</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.generate_roads-335"><a href="#RoadNetworkGrid.generate_roads-335"><span class="linenos">335</span></a>                            <span class="n">charging_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">charging_point_density</span>
</span><span id="RoadNetworkGrid.generate_roads-336"><a href="#RoadNetworkGrid.generate_roads-336"><span class="linenos">336</span></a>                            <span class="n">rnw</span><span class="o">.</span><span class="n">add_destination</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">charging_point</span> <span class="o">=</span> <span class="n">charging_point</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.generate_roads-337"><a href="#RoadNetworkGrid.generate_roads-337"><span class="linenos">337</span></a>                            <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>Generates the road network. This is a two step process.
First, a coarse undirected network is generated, where each node corresponds to a grid cell.
Heustistics are used to try to spread this network over the grid and have a balance between dense and sprawling roads.
Second, this network is expanded into a directed graph, containing separate roadways and roundabouts.
This is achieved by dividing each coarse network node / grid cell into 4 x 4 subnodes.
These are connected so that traffic in all directions become possible.
In the resulting directed network, each node has either one or two outgoing edges.
The network keeps track of what agents are currently in a node.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.priority_nodes" class="classattr">
                                        <input id="RoadNetworkGrid.priority_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">priority_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">from_node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">to_node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.priority_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.priority_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.priority_nodes-365"><a href="#RoadNetworkGrid.priority_nodes-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">priority_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">to_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.priority_nodes-366"><a href="#RoadNetworkGrid.priority_nodes-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.priority_nodes-367"><a href="#RoadNetworkGrid.priority_nodes-367"><span class="linenos">367</span></a><span class="sd">        Returns the nodes from which traffic has priority over from_node when going into to_node.</span>
</span><span id="RoadNetworkGrid.priority_nodes-368"><a href="#RoadNetworkGrid.priority_nodes-368"><span class="linenos">368</span></a><span class="sd">        This is traffic coming from the left in a roundabout, and any traffic when leaving a parking.</span>
</span><span id="RoadNetworkGrid.priority_nodes-369"><a href="#RoadNetworkGrid.priority_nodes-369"><span class="linenos">369</span></a>
</span><span id="RoadNetworkGrid.priority_nodes-370"><a href="#RoadNetworkGrid.priority_nodes-370"><span class="linenos">370</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.priority_nodes-371"><a href="#RoadNetworkGrid.priority_nodes-371"><span class="linenos">371</span></a><span class="sd">            from_node (Node): the node to be checked for priority.</span>
</span><span id="RoadNetworkGrid.priority_nodes-372"><a href="#RoadNetworkGrid.priority_nodes-372"><span class="linenos">372</span></a><span class="sd">            to_node (Node): the node to be checked for priority.</span>
</span><span id="RoadNetworkGrid.priority_nodes-373"><a href="#RoadNetworkGrid.priority_nodes-373"><span class="linenos">373</span></a>
</span><span id="RoadNetworkGrid.priority_nodes-374"><a href="#RoadNetworkGrid.priority_nodes-374"><span class="linenos">374</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.priority_nodes-375"><a href="#RoadNetworkGrid.priority_nodes-375"><span class="linenos">375</span></a><span class="sd">            list[Node]: a list of nodes from which vehicles have priority.</span>
</span><span id="RoadNetworkGrid.priority_nodes-376"><a href="#RoadNetworkGrid.priority_nodes-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.priority_nodes-377"><a href="#RoadNetworkGrid.priority_nodes-377"><span class="linenos">377</span></a>        <span class="n">rnw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span>
</span><span id="RoadNetworkGrid.priority_nodes-378"><a href="#RoadNetworkGrid.priority_nodes-378"><span class="linenos">378</span></a>        <span class="c1"># Determine which node has priority entering to_node.</span>
</span><span id="RoadNetworkGrid.priority_nodes-379"><a href="#RoadNetworkGrid.priority_nodes-379"><span class="linenos">379</span></a>
</span><span id="RoadNetworkGrid.priority_nodes-380"><a href="#RoadNetworkGrid.priority_nodes-380"><span class="linenos">380</span></a>        <span class="c1"># If from_node is a destination, all other nodes going into to_node have priority.</span>
</span><span id="RoadNetworkGrid.priority_nodes-381"><a href="#RoadNetworkGrid.priority_nodes-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">from_node</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.priority_nodes-382"><a href="#RoadNetworkGrid.priority_nodes-382"><span class="linenos">382</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">roads_to</span><span class="p">(</span><span class="n">to_node</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="o">!=</span> <span class="n">from_node</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.priority_nodes-383"><a href="#RoadNetworkGrid.priority_nodes-383"><span class="linenos">383</span></a>
</span><span id="RoadNetworkGrid.priority_nodes-384"><a href="#RoadNetworkGrid.priority_nodes-384"><span class="linenos">384</span></a>        <span class="c1"># In a roundabout, a vehicle going S yields to one going W, E to S, N to E, and W to N.</span>
</span><span id="RoadNetworkGrid.priority_nodes-385"><a href="#RoadNetworkGrid.priority_nodes-385"><span class="linenos">385</span></a>        <span class="n">priority_rule</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">180</span> <span class="p">:</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">90</span> <span class="p">:</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">0</span> <span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">270</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
</span><span id="RoadNetworkGrid.priority_nodes-386"><a href="#RoadNetworkGrid.priority_nodes-386"><span class="linenos">386</span></a>        <span class="n">priority_direction</span> <span class="o">=</span> <span class="n">priority_rule</span><span class="p">[</span><span class="n">rnw</span><span class="p">[</span><span class="n">from_node</span><span class="p">][</span><span class="n">to_node</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]]</span>
</span><span id="RoadNetworkGrid.priority_nodes-387"><a href="#RoadNetworkGrid.priority_nodes-387"><span class="linenos">387</span></a>        <span class="n">priority_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">rnw</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">to_node</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;direction&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">priority_direction</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.priority_nodes-388"><a href="#RoadNetworkGrid.priority_nodes-388"><span class="linenos">388</span></a>
</span><span id="RoadNetworkGrid.priority_nodes-389"><a href="#RoadNetworkGrid.priority_nodes-389"><span class="linenos">389</span></a>        <span class="c1"># If the priority node can reach to_node, return it, otherwise return nothing.</span>
</span><span id="RoadNetworkGrid.priority_nodes-390"><a href="#RoadNetworkGrid.priority_nodes-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="n">priority_nodes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">to_node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="RoadNetworkGrid.priority_nodes-391"><a href="#RoadNetworkGrid.priority_nodes-391"><span class="linenos">391</span></a>            <span class="k">return</span> <span class="n">priority_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.priority_nodes-392"><a href="#RoadNetworkGrid.priority_nodes-392"><span class="linenos">392</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.priority_nodes-393"><a href="#RoadNetworkGrid.priority_nodes-393"><span class="linenos">393</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the nodes from which traffic has priority over from_node when going into to_node.
This is traffic coming from the left in a roundabout, and any traffic when leaving a parking.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>from_node (Node):</strong>  the node to be checked for priority.</li>
<li><strong>to_node (Node):</strong>  the node to be checked for priority.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: a list of nodes from which vehicles have priority.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.road_nodes" class="classattr">
                                        <input id="RoadNetworkGrid.road_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">road_nodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">RoadNetworkGrid</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.road_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.road_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.road_nodes-395"><a href="#RoadNetworkGrid.road_nodes-395"><span class="linenos">395</span></a>    <span class="k">def</span> <span class="nf">road_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.road_nodes-396"><a href="#RoadNetworkGrid.road_nodes-396"><span class="linenos">396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.road_nodes-397"><a href="#RoadNetworkGrid.road_nodes-397"><span class="linenos">397</span></a><span class="sd">        Returns a list of all nodes which are connected by roads.</span>
</span><span id="RoadNetworkGrid.road_nodes-398"><a href="#RoadNetworkGrid.road_nodes-398"><span class="linenos">398</span></a>
</span><span id="RoadNetworkGrid.road_nodes-399"><a href="#RoadNetworkGrid.road_nodes-399"><span class="linenos">399</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.road_nodes-400"><a href="#RoadNetworkGrid.road_nodes-400"><span class="linenos">400</span></a><span class="sd">            condition: a condition that the nodes must satisfy. Defaults to always True.</span>
</span><span id="RoadNetworkGrid.road_nodes-401"><a href="#RoadNetworkGrid.road_nodes-401"><span class="linenos">401</span></a>
</span><span id="RoadNetworkGrid.road_nodes-402"><a href="#RoadNetworkGrid.road_nodes-402"><span class="linenos">402</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.road_nodes-403"><a href="#RoadNetworkGrid.road_nodes-403"><span class="linenos">403</span></a><span class="sd">            list[Node]: the nodes connected by roads.</span>
</span><span id="RoadNetworkGrid.road_nodes-404"><a href="#RoadNetworkGrid.road_nodes-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.road_nodes-405"><a href="#RoadNetworkGrid.road_nodes-405"><span class="linenos">405</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all nodes which are connected by roads.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>condition:</strong>  a condition that the nodes must satisfy. Defaults to always True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: the nodes connected by roads.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.destination_nodes" class="classattr">
                                        <input id="RoadNetworkGrid.destination_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">destination_nodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">RoadNetworkGrid</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.destination_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.destination_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.destination_nodes-407"><a href="#RoadNetworkGrid.destination_nodes-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">destination_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.destination_nodes-408"><a href="#RoadNetworkGrid.destination_nodes-408"><span class="linenos">408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.destination_nodes-409"><a href="#RoadNetworkGrid.destination_nodes-409"><span class="linenos">409</span></a><span class="sd">        Returns a list of all nodes which are destinations.</span>
</span><span id="RoadNetworkGrid.destination_nodes-410"><a href="#RoadNetworkGrid.destination_nodes-410"><span class="linenos">410</span></a>
</span><span id="RoadNetworkGrid.destination_nodes-411"><a href="#RoadNetworkGrid.destination_nodes-411"><span class="linenos">411</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.destination_nodes-412"><a href="#RoadNetworkGrid.destination_nodes-412"><span class="linenos">412</span></a><span class="sd">            condition: a condition that the nodes must satisfy. Defaults to always True.</span>
</span><span id="RoadNetworkGrid.destination_nodes-413"><a href="#RoadNetworkGrid.destination_nodes-413"><span class="linenos">413</span></a>
</span><span id="RoadNetworkGrid.destination_nodes-414"><a href="#RoadNetworkGrid.destination_nodes-414"><span class="linenos">414</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.destination_nodes-415"><a href="#RoadNetworkGrid.destination_nodes-415"><span class="linenos">415</span></a><span class="sd">            list[Node]: the destinations.</span>
</span><span id="RoadNetworkGrid.destination_nodes-416"><a href="#RoadNetworkGrid.destination_nodes-416"><span class="linenos">416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.destination_nodes-417"><a href="#RoadNetworkGrid.destination_nodes-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_destination</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all nodes which are destinations.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>condition:</strong>  a condition that the nodes must satisfy. Defaults to always True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: the destinations.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.road_edges" class="classattr">
                                        <input id="RoadNetworkGrid.road_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">road_edges</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Edge">space.Edge</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.road_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.road_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.road_edges-419"><a href="#RoadNetworkGrid.road_edges-419"><span class="linenos">419</span></a>    <span class="k">def</span> <span class="nf">road_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Edge</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.road_edges-420"><a href="#RoadNetworkGrid.road_edges-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.road_edges-421"><a href="#RoadNetworkGrid.road_edges-421"><span class="linenos">421</span></a><span class="sd">        Returns a list of all edges that are roads.</span>
</span><span id="RoadNetworkGrid.road_edges-422"><a href="#RoadNetworkGrid.road_edges-422"><span class="linenos">422</span></a>
</span><span id="RoadNetworkGrid.road_edges-423"><a href="#RoadNetworkGrid.road_edges-423"><span class="linenos">423</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.road_edges-424"><a href="#RoadNetworkGrid.road_edges-424"><span class="linenos">424</span></a><span class="sd">            list[Node]: the nodes connected by roads.</span>
</span><span id="RoadNetworkGrid.road_edges-425"><a href="#RoadNetworkGrid.road_edges-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.road_edges-426"><a href="#RoadNetworkGrid.road_edges-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">Edge</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">edges</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all edges that are roads.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: the nodes connected by roads.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.roads_from" class="classattr">
                                        <input id="RoadNetworkGrid.roads_from-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">roads_from</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">RoadNetworkGrid</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.roads_from-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.roads_from"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.roads_from-428"><a href="#RoadNetworkGrid.roads_from-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">roads_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span> <span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.roads_from-429"><a href="#RoadNetworkGrid.roads_from-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.roads_from-430"><a href="#RoadNetworkGrid.roads_from-430"><span class="linenos">430</span></a><span class="sd">        Returns a list of all nodes that can be reached by road from a given source node.</span>
</span><span id="RoadNetworkGrid.roads_from-431"><a href="#RoadNetworkGrid.roads_from-431"><span class="linenos">431</span></a><span class="sd">        If a condition function is provided, only nodes fulfilling that condition are returned.</span>
</span><span id="RoadNetworkGrid.roads_from-432"><a href="#RoadNetworkGrid.roads_from-432"><span class="linenos">432</span></a>
</span><span id="RoadNetworkGrid.roads_from-433"><a href="#RoadNetworkGrid.roads_from-433"><span class="linenos">433</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.roads_from-434"><a href="#RoadNetworkGrid.roads_from-434"><span class="linenos">434</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadNetworkGrid.roads_from-435"><a href="#RoadNetworkGrid.roads_from-435"><span class="linenos">435</span></a><span class="sd">            condition (Callable[[Node], bool], optional): a condition on the nodes. Defaults to always True.</span>
</span><span id="RoadNetworkGrid.roads_from-436"><a href="#RoadNetworkGrid.roads_from-436"><span class="linenos">436</span></a><span class="sd">            </span>
</span><span id="RoadNetworkGrid.roads_from-437"><a href="#RoadNetworkGrid.roads_from-437"><span class="linenos">437</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.roads_from-438"><a href="#RoadNetworkGrid.roads_from-438"><span class="linenos">438</span></a><span class="sd">            list[Node]: a list of nodes reachable by road.</span>
</span><span id="RoadNetworkGrid.roads_from-439"><a href="#RoadNetworkGrid.roads_from-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.roads_from-440"><a href="#RoadNetworkGrid.roads_from-440"><span class="linenos">440</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">sink</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">sink</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all nodes that can be reached by road from a given source node.
If a condition function is provided, only nodes fulfilling that condition are returned.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>source (Node):</strong>  the source node.</li>
<li><strong>condition (Callable[[Node], bool], optional):</strong>  a condition on the nodes. Defaults to always True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: a list of nodes reachable by road.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.roads_to" class="classattr">
                                        <input id="RoadNetworkGrid.roads_to-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">roads_to</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">sink</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">RoadNetworkGrid</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.roads_to-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.roads_to"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.roads_to-442"><a href="#RoadNetworkGrid.roads_to-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">roads_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Node</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span> <span class="p">:</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.roads_to-443"><a href="#RoadNetworkGrid.roads_to-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.roads_to-444"><a href="#RoadNetworkGrid.roads_to-444"><span class="linenos">444</span></a><span class="sd">        Returns a list of all nodes that can reach the given sink node by road.</span>
</span><span id="RoadNetworkGrid.roads_to-445"><a href="#RoadNetworkGrid.roads_to-445"><span class="linenos">445</span></a><span class="sd">        If a condition function is provided, only nodes fulfilling that condition are returned.</span>
</span><span id="RoadNetworkGrid.roads_to-446"><a href="#RoadNetworkGrid.roads_to-446"><span class="linenos">446</span></a>
</span><span id="RoadNetworkGrid.roads_to-447"><a href="#RoadNetworkGrid.roads_to-447"><span class="linenos">447</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.roads_to-448"><a href="#RoadNetworkGrid.roads_to-448"><span class="linenos">448</span></a><span class="sd">            sink (Node): the sink node.</span>
</span><span id="RoadNetworkGrid.roads_to-449"><a href="#RoadNetworkGrid.roads_to-449"><span class="linenos">449</span></a><span class="sd">            condition (Callable[[Node], bool], optional): a condition on the nodes. Defaults to always True.</span>
</span><span id="RoadNetworkGrid.roads_to-450"><a href="#RoadNetworkGrid.roads_to-450"><span class="linenos">450</span></a>
</span><span id="RoadNetworkGrid.roads_to-451"><a href="#RoadNetworkGrid.roads_to-451"><span class="linenos">451</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.roads_to-452"><a href="#RoadNetworkGrid.roads_to-452"><span class="linenos">452</span></a><span class="sd">            list[Node]: a list of nodes from which the sink node can be reached by road.</span>
</span><span id="RoadNetworkGrid.roads_to-453"><a href="#RoadNetworkGrid.roads_to-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.roads_to-454"><a href="#RoadNetworkGrid.roads_to-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">source</span> <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">has_road</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;road&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_road</span> <span class="ow">and</span> <span class="n">condition</span><span class="p">(</span><span class="n">source</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all nodes that can reach the given sink node by road.
If a condition function is provided, only nodes fulfilling that condition are returned.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>sink (Node):</strong>  the sink node.</li>
<li><strong>condition (Callable[[Node], bool], optional):</strong>  a condition on the nodes. Defaults to always True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: a list of nodes from which the sink node can be reached by road.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.is_destination" class="classattr">
                                        <input id="RoadNetworkGrid.is_destination-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_destination</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.is_destination-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.is_destination"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.is_destination-456"><a href="#RoadNetworkGrid.is_destination-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">is_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.is_destination-457"><a href="#RoadNetworkGrid.is_destination-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_destination-458"><a href="#RoadNetworkGrid.is_destination-458"><span class="linenos">458</span></a><span class="sd">        Checks if a node is a destination.</span>
</span><span id="RoadNetworkGrid.is_destination-459"><a href="#RoadNetworkGrid.is_destination-459"><span class="linenos">459</span></a>
</span><span id="RoadNetworkGrid.is_destination-460"><a href="#RoadNetworkGrid.is_destination-460"><span class="linenos">460</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.is_destination-461"><a href="#RoadNetworkGrid.is_destination-461"><span class="linenos">461</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadNetworkGrid.is_destination-462"><a href="#RoadNetworkGrid.is_destination-462"><span class="linenos">462</span></a>
</span><span id="RoadNetworkGrid.is_destination-463"><a href="#RoadNetworkGrid.is_destination-463"><span class="linenos">463</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.is_destination-464"><a href="#RoadNetworkGrid.is_destination-464"><span class="linenos">464</span></a><span class="sd">            bool: True if the node is a destination.</span>
</span><span id="RoadNetworkGrid.is_destination-465"><a href="#RoadNetworkGrid.is_destination-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_destination-466"><a href="#RoadNetworkGrid.is_destination-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destination&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks if a node is a destination.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node (Node):</strong>  the node.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True if the node is a destination.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.is_charging_point" class="classattr">
                                        <input id="RoadNetworkGrid.is_charging_point-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_charging_point</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.is_charging_point-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.is_charging_point"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.is_charging_point-468"><a href="#RoadNetworkGrid.is_charging_point-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">is_charging_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.is_charging_point-469"><a href="#RoadNetworkGrid.is_charging_point-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_charging_point-470"><a href="#RoadNetworkGrid.is_charging_point-470"><span class="linenos">470</span></a><span class="sd">        Checks if a node is a charging point.</span>
</span><span id="RoadNetworkGrid.is_charging_point-471"><a href="#RoadNetworkGrid.is_charging_point-471"><span class="linenos">471</span></a>
</span><span id="RoadNetworkGrid.is_charging_point-472"><a href="#RoadNetworkGrid.is_charging_point-472"><span class="linenos">472</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.is_charging_point-473"><a href="#RoadNetworkGrid.is_charging_point-473"><span class="linenos">473</span></a><span class="sd">            node (Node): the node.</span>
</span><span id="RoadNetworkGrid.is_charging_point-474"><a href="#RoadNetworkGrid.is_charging_point-474"><span class="linenos">474</span></a>
</span><span id="RoadNetworkGrid.is_charging_point-475"><a href="#RoadNetworkGrid.is_charging_point-475"><span class="linenos">475</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.is_charging_point-476"><a href="#RoadNetworkGrid.is_charging_point-476"><span class="linenos">476</span></a><span class="sd">            bool: True if the node is a charging point.</span>
</span><span id="RoadNetworkGrid.is_charging_point-477"><a href="#RoadNetworkGrid.is_charging_point-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_charging_point-478"><a href="#RoadNetworkGrid.is_charging_point-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;charging_point&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks if a node is a charging point.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>node (Node):</strong>  the node.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True if the node is a charging point.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.edge_direction" class="classattr">
                                        <input id="RoadNetworkGrid.edge_direction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">edge_direction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">sink</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.edge_direction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.edge_direction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.edge_direction-480"><a href="#RoadNetworkGrid.edge_direction-480"><span class="linenos">480</span></a>    <span class="k">def</span> <span class="nf">edge_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">sink</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Direction</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.edge_direction-481"><a href="#RoadNetworkGrid.edge_direction-481"><span class="linenos">481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.edge_direction-482"><a href="#RoadNetworkGrid.edge_direction-482"><span class="linenos">482</span></a><span class="sd">        Returns the direction of the edge going from source to sink.</span>
</span><span id="RoadNetworkGrid.edge_direction-483"><a href="#RoadNetworkGrid.edge_direction-483"><span class="linenos">483</span></a>
</span><span id="RoadNetworkGrid.edge_direction-484"><a href="#RoadNetworkGrid.edge_direction-484"><span class="linenos">484</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.edge_direction-485"><a href="#RoadNetworkGrid.edge_direction-485"><span class="linenos">485</span></a><span class="sd">            source (Node): source node.</span>
</span><span id="RoadNetworkGrid.edge_direction-486"><a href="#RoadNetworkGrid.edge_direction-486"><span class="linenos">486</span></a><span class="sd">            sink (Node): sink node.</span>
</span><span id="RoadNetworkGrid.edge_direction-487"><a href="#RoadNetworkGrid.edge_direction-487"><span class="linenos">487</span></a>
</span><span id="RoadNetworkGrid.edge_direction-488"><a href="#RoadNetworkGrid.edge_direction-488"><span class="linenos">488</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.edge_direction-489"><a href="#RoadNetworkGrid.edge_direction-489"><span class="linenos">489</span></a><span class="sd">            Direction: the direction in degrees.</span>
</span><span id="RoadNetworkGrid.edge_direction-490"><a href="#RoadNetworkGrid.edge_direction-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.edge_direction-491"><a href="#RoadNetworkGrid.edge_direction-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">sink</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the direction of the edge going from source to sink.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>source (Node):</strong>  source node.</li>
<li><strong>sink (Node):</strong>  sink node.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Direction: the direction in degrees.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.shortest_path" class="classattr">
                                        <input id="RoadNetworkGrid.shortest_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shortest_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">target</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.shortest_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.shortest_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.shortest_path-493"><a href="#RoadNetworkGrid.shortest_path-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.shortest_path-494"><a href="#RoadNetworkGrid.shortest_path-494"><span class="linenos">494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.shortest_path-495"><a href="#RoadNetworkGrid.shortest_path-495"><span class="linenos">495</span></a><span class="sd">        Returns the shortest path from source to sink as a list of nodes.</span>
</span><span id="RoadNetworkGrid.shortest_path-496"><a href="#RoadNetworkGrid.shortest_path-496"><span class="linenos">496</span></a>
</span><span id="RoadNetworkGrid.shortest_path-497"><a href="#RoadNetworkGrid.shortest_path-497"><span class="linenos">497</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.shortest_path-498"><a href="#RoadNetworkGrid.shortest_path-498"><span class="linenos">498</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadNetworkGrid.shortest_path-499"><a href="#RoadNetworkGrid.shortest_path-499"><span class="linenos">499</span></a><span class="sd">            target (Node): the target node.</span>
</span><span id="RoadNetworkGrid.shortest_path-500"><a href="#RoadNetworkGrid.shortest_path-500"><span class="linenos">500</span></a>
</span><span id="RoadNetworkGrid.shortest_path-501"><a href="#RoadNetworkGrid.shortest_path-501"><span class="linenos">501</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.shortest_path-502"><a href="#RoadNetworkGrid.shortest_path-502"><span class="linenos">502</span></a><span class="sd">            list[Node]: the path.</span>
</span><span id="RoadNetworkGrid.shortest_path-503"><a href="#RoadNetworkGrid.shortest_path-503"><span class="linenos">503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.shortest_path-504"><a href="#RoadNetworkGrid.shortest_path-504"><span class="linenos">504</span></a>        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">,</span>
</span><span id="RoadNetworkGrid.shortest_path-505"><a href="#RoadNetworkGrid.shortest_path-505"><span class="linenos">505</span></a>                                <span class="n">weight</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;road&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">10000000</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the shortest path from source to sink as a list of nodes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>source (Node):</strong>  the source node.</li>
<li><strong>target (Node):</strong>  the target node.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: the path.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.path_to_nearest" class="classattr">
                                        <input id="RoadNetworkGrid.path_to_nearest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">path_to_nearest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.path_to_nearest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.path_to_nearest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.path_to_nearest-507"><a href="#RoadNetworkGrid.path_to_nearest-507"><span class="linenos">507</span></a>    <span class="k">def</span> <span class="nf">path_to_nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.path_to_nearest-508"><a href="#RoadNetworkGrid.path_to_nearest-508"><span class="linenos">508</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.path_to_nearest-509"><a href="#RoadNetworkGrid.path_to_nearest-509"><span class="linenos">509</span></a><span class="sd">        Given a source node and a list of target nodes, return the path to the nearest of the targets.</span>
</span><span id="RoadNetworkGrid.path_to_nearest-510"><a href="#RoadNetworkGrid.path_to_nearest-510"><span class="linenos">510</span></a>
</span><span id="RoadNetworkGrid.path_to_nearest-511"><a href="#RoadNetworkGrid.path_to_nearest-511"><span class="linenos">511</span></a><span class="sd">        Args:</span>
</span><span id="RoadNetworkGrid.path_to_nearest-512"><a href="#RoadNetworkGrid.path_to_nearest-512"><span class="linenos">512</span></a><span class="sd">            source (Node): the source node.</span>
</span><span id="RoadNetworkGrid.path_to_nearest-513"><a href="#RoadNetworkGrid.path_to_nearest-513"><span class="linenos">513</span></a><span class="sd">            targets (list[Node]): the list of target nodes.</span>
</span><span id="RoadNetworkGrid.path_to_nearest-514"><a href="#RoadNetworkGrid.path_to_nearest-514"><span class="linenos">514</span></a>
</span><span id="RoadNetworkGrid.path_to_nearest-515"><a href="#RoadNetworkGrid.path_to_nearest-515"><span class="linenos">515</span></a><span class="sd">        Returns:</span>
</span><span id="RoadNetworkGrid.path_to_nearest-516"><a href="#RoadNetworkGrid.path_to_nearest-516"><span class="linenos">516</span></a><span class="sd">            list[Node]: the path to the nearest target node.</span>
</span><span id="RoadNetworkGrid.path_to_nearest-517"><a href="#RoadNetworkGrid.path_to_nearest-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.path_to_nearest-518"><a href="#RoadNetworkGrid.path_to_nearest-518"><span class="linenos">518</span></a>        <span class="n">shortest_paths</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.path_to_nearest-519"><a href="#RoadNetworkGrid.path_to_nearest-519"><span class="linenos">519</span></a>        <span class="n">shortest_paths</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="nb">len</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.path_to_nearest-520"><a href="#RoadNetworkGrid.path_to_nearest-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="n">shortest_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Given a source node and a list of target nodes, return the path to the nearest of the targets.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>source (Node):</strong>  the source node.</li>
<li><strong>targets (list[Node]):</strong>  the list of target nodes.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[Node]: the path to the nearest target node.</p>
</blockquote>
</div>


                            </div>
                            <div id="RoadNetworkGrid.has_road_to" class="classattr">
                                        <input id="RoadNetworkGrid.has_road_to-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_road_to</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">source</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">direction</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.has_road_to-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.has_road_to"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.has_road_to-524"><a href="#RoadNetworkGrid.has_road_to-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">has_road_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.has_road_to-525"><a href="#RoadNetworkGrid.has_road_to-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.has_road_to-526"><a href="#RoadNetworkGrid.has_road_to-526"><span class="linenos">526</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="RoadNetworkGrid.has_road_to-527"><a href="#RoadNetworkGrid.has_road_to-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.has_road_to-528"><a href="#RoadNetworkGrid.has_road_to-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">has_road_to</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calls the method with the same name on self.road_network.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.is_road" class="classattr">
                                        <input id="RoadNetworkGrid.is_road-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_road</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node1</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>, </span><span class="param"><span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.is_road-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.is_road"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.is_road-530"><a href="#RoadNetworkGrid.is_road-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">is_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.is_road-531"><a href="#RoadNetworkGrid.is_road-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_road-532"><a href="#RoadNetworkGrid.is_road-532"><span class="linenos">532</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="RoadNetworkGrid.is_road-533"><a href="#RoadNetworkGrid.is_road-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_road-534"><a href="#RoadNetworkGrid.is_road-534"><span class="linenos">534</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">is_road</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calls the method with the same name on self.road_network.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.grid_neighbors" class="classattr">
                                        <input id="RoadNetworkGrid.grid_neighbors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grid_neighbors</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">node</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.grid_neighbors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.grid_neighbors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.grid_neighbors-536"><a href="#RoadNetworkGrid.grid_neighbors-536"><span class="linenos">536</span></a>    <span class="k">def</span> <span class="nf">grid_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.grid_neighbors-537"><a href="#RoadNetworkGrid.grid_neighbors-537"><span class="linenos">537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.grid_neighbors-538"><a href="#RoadNetworkGrid.grid_neighbors-538"><span class="linenos">538</span></a><span class="sd">        Calls the method with the same name on self.road_network.</span>
</span><span id="RoadNetworkGrid.grid_neighbors-539"><a href="#RoadNetworkGrid.grid_neighbors-539"><span class="linenos">539</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.grid_neighbors-540"><a href="#RoadNetworkGrid.grid_neighbors-540"><span class="linenos">540</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">grid_neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calls the method with the same name on self.road_network.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.place_agent" class="classattr">
                                        <input id="RoadNetworkGrid.place_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">place_agent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a href="core.html#Agent">core.Agent</a></span>, </span><span class="param"><span class="n">node_id</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.place_agent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.place_agent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.place_agent-544"><a href="#RoadNetworkGrid.place_agent-544"><span class="linenos">544</span></a>    <span class="k">def</span> <span class="nf">place_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.place_agent-545"><a href="#RoadNetworkGrid.place_agent-545"><span class="linenos">545</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Place an agent in a node.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.place_agent-546"><a href="#RoadNetworkGrid.place_agent-546"><span class="linenos">546</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.place_agent-547"><a href="#RoadNetworkGrid.place_agent-547"><span class="linenos">547</span></a>        <span class="n">agent</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="RoadNetworkGrid.place_agent-548"><a href="#RoadNetworkGrid.place_agent-548"><span class="linenos">548</span></a>        <span class="c1"># If there are other agents in the node with which the agent cannot co-exist, raise an exception</span>
</span><span id="RoadNetworkGrid.place_agent-549"><a href="#RoadNetworkGrid.place_agent-549"><span class="linenos">549</span></a>        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.place_agent-550"><a href="#RoadNetworkGrid.place_agent-550"><span class="linenos">550</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">can_coexist</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.place_agent-551"><a href="#RoadNetworkGrid.place_agent-551"><span class="linenos">551</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">: Agents cannot coexist: </span><span class="si">{</span><span class="n">agent</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Place an agent in a node.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.get_neighborhood" class="classattr">
                                        <input id="RoadNetworkGrid.get_neighborhood-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_neighborhood</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">node_id</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.get_neighborhood-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.get_neighborhood"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.get_neighborhood-553"><a href="#RoadNetworkGrid.get_neighborhood-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">get_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.get_neighborhood-554"><a href="#RoadNetworkGrid.get_neighborhood-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all adjacent nodes within a certain radius&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.get_neighborhood-555"><a href="#RoadNetworkGrid.get_neighborhood-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">radius</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.get_neighborhood-556"><a href="#RoadNetworkGrid.get_neighborhood-556"><span class="linenos">556</span></a>            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="RoadNetworkGrid.get_neighborhood-557"><a href="#RoadNetworkGrid.get_neighborhood-557"><span class="linenos">557</span></a>            <span class="k">if</span> <span class="n">include_center</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.get_neighborhood-558"><a href="#RoadNetworkGrid.get_neighborhood-558"><span class="linenos">558</span></a>                <span class="n">neighborhood</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.get_neighborhood-559"><a href="#RoadNetworkGrid.get_neighborhood-559"><span class="linenos">559</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.get_neighborhood-560"><a href="#RoadNetworkGrid.get_neighborhood-560"><span class="linenos">560</span></a>            <span class="n">neighbors_with_distance</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">single_source_shortest_path_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.get_neighborhood-561"><a href="#RoadNetworkGrid.get_neighborhood-561"><span class="linenos">561</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_center</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.get_neighborhood-562"><a href="#RoadNetworkGrid.get_neighborhood-562"><span class="linenos">562</span></a>                <span class="k">del</span> <span class="n">neighbors_with_distance</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.get_neighborhood-563"><a href="#RoadNetworkGrid.get_neighborhood-563"><span class="linenos">563</span></a>            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">neighbors_with_distance</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="RoadNetworkGrid.get_neighborhood-564"><a href="#RoadNetworkGrid.get_neighborhood-564"><span class="linenos">564</span></a>        <span class="k">return</span> <span class="n">neighborhood</span>
</span></pre></div>


            <div class="docstring"><p>Get all adjacent nodes within a certain radius</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.get_neighbors" class="classattr">
                                        <input id="RoadNetworkGrid.get_neighbors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_neighbors</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">node_id</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span>,</span><span class="param">	<span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="core.html#Agent">core.Agent</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.get_neighbors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.get_neighbors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.get_neighbors-566"><a href="#RoadNetworkGrid.get_neighbors-566"><span class="linenos">566</span></a>    <span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.get_neighbors-567"><a href="#RoadNetworkGrid.get_neighbors-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all agents in adjacent nodes.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.get_neighbors-568"><a href="#RoadNetworkGrid.get_neighbors-568"><span class="linenos">568</span></a>        <span class="n">neighborhood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">include_center</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.get_neighbors-569"><a href="#RoadNetworkGrid.get_neighbors-569"><span class="linenos">569</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_list_contents</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get all agents in adjacent nodes.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.move_agent" class="classattr">
                                        <input id="RoadNetworkGrid.move_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_agent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a href="core.html#Agent">core.Agent</a></span>, </span><span class="param"><span class="n">node_id</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.move_agent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.move_agent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.move_agent-571"><a href="#RoadNetworkGrid.move_agent-571"><span class="linenos">571</span></a>    <span class="k">def</span> <span class="nf">move_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.move_agent-572"><a href="#RoadNetworkGrid.move_agent-572"><span class="linenos">572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move an agent from its current node to a new node.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.move_agent-573"><a href="#RoadNetworkGrid.move_agent-573"><span class="linenos">573</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="s2">&quot;heading&quot;</span><span class="p">):</span>
</span><span id="RoadNetworkGrid.move_agent-574"><a href="#RoadNetworkGrid.move_agent-574"><span class="linenos">574</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">pos</span><span class="p">][</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.move_agent-575"><a href="#RoadNetworkGrid.move_agent-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.move_agent-576"><a href="#RoadNetworkGrid.move_agent-576"><span class="linenos">576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">place_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Move an agent from its current node to a new node.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.remove_agent" class="classattr">
                                        <input id="RoadNetworkGrid.remove_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_agent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a href="core.html#Agent">core.Agent</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.remove_agent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.remove_agent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.remove_agent-578"><a href="#RoadNetworkGrid.remove_agent-578"><span class="linenos">578</span></a>    <span class="k">def</span> <span class="nf">remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.remove_agent-579"><a href="#RoadNetworkGrid.remove_agent-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the agent from the network and set its pos attribute to None.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.remove_agent-580"><a href="#RoadNetworkGrid.remove_agent-580"><span class="linenos">580</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pos</span>
</span><span id="RoadNetworkGrid.remove_agent-581"><a href="#RoadNetworkGrid.remove_agent-581"><span class="linenos">581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.remove_agent-582"><a href="#RoadNetworkGrid.remove_agent-582"><span class="linenos">582</span></a>        <span class="n">agent</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Node</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Remove the agent from the network and set its pos attribute to None.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.is_cell_empty" class="classattr">
                                        <input id="RoadNetworkGrid.is_cell_empty-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_cell_empty</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node_id</span><span class="p">:</span> <span class="n"><a href="#Node">space.Node</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.is_cell_empty-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.is_cell_empty"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.is_cell_empty-584"><a href="#RoadNetworkGrid.is_cell_empty-584"><span class="linenos">584</span></a>    <span class="k">def</span> <span class="nf">is_cell_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="RoadNetworkGrid.is_cell_empty-585"><a href="#RoadNetworkGrid.is_cell_empty-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a bool of the contents of a cell.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.is_cell_empty-586"><a href="#RoadNetworkGrid.is_cell_empty-586"><span class="linenos">586</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a bool of the contents of a cell.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.get_cell_list_contents" class="classattr">
                                        <input id="RoadNetworkGrid.get_cell_list_contents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_cell_list_contents</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="core.html#Agent">core.Agent</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.get_cell_list_contents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.get_cell_list_contents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.get_cell_list_contents-588"><a href="#RoadNetworkGrid.get_cell_list_contents-588"><span class="linenos">588</span></a>    <span class="k">def</span> <span class="nf">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.get_cell_list_contents-589"><a href="#RoadNetworkGrid.get_cell_list_contents-589"><span class="linenos">589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of the agents contained in the nodes identified</span>
</span><span id="RoadNetworkGrid.get_cell_list_contents-590"><a href="#RoadNetworkGrid.get_cell_list_contents-590"><span class="linenos">590</span></a><span class="sd">        in `cell_list`; nodes with empty content are excluded.</span>
</span><span id="RoadNetworkGrid.get_cell_list_contents-591"><a href="#RoadNetworkGrid.get_cell_list_contents-591"><span class="linenos">591</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.get_cell_list_contents-592"><a href="#RoadNetworkGrid.get_cell_list_contents-592"><span class="linenos">592</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_cell_list_contents</span><span class="p">(</span><span class="n">cell_list</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of the agents contained in the nodes identified
in <code>cell_list</code>; nodes with empty content are excluded.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.get_all_cell_contents" class="classattr">
                                        <input id="RoadNetworkGrid.get_all_cell_contents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_cell_contents</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="core.html#Agent">core.Agent</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.get_all_cell_contents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.get_all_cell_contents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.get_all_cell_contents-594"><a href="#RoadNetworkGrid.get_all_cell_contents-594"><span class="linenos">594</span></a>    <span class="k">def</span> <span class="nf">get_all_cell_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.get_all_cell_contents-595"><a href="#RoadNetworkGrid.get_all_cell_contents-595"><span class="linenos">595</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of all the agents in the network.&quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.get_all_cell_contents-596"><a href="#RoadNetworkGrid.get_all_cell_contents-596"><span class="linenos">596</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of all the agents in the network.</p>
</div>


                            </div>
                            <div id="RoadNetworkGrid.iter_cell_list_contents" class="classattr">
                                        <input id="RoadNetworkGrid.iter_cell_list_contents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iter_cell_list_contents</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Node">space.Node</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="core.html#Agent">core.Agent</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RoadNetworkGrid.iter_cell_list_contents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoadNetworkGrid.iter_cell_list_contents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoadNetworkGrid.iter_cell_list_contents-598"><a href="#RoadNetworkGrid.iter_cell_list_contents-598"><span class="linenos">598</span></a>    <span class="k">def</span> <span class="nf">iter_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Agent</span><span class="p">]:</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-599"><a href="#RoadNetworkGrid.iter_cell_list_contents-599"><span class="linenos">599</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an iterator of the agents contained in the nodes identified</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-600"><a href="#RoadNetworkGrid.iter_cell_list_contents-600"><span class="linenos">600</span></a><span class="sd">        in `cell_list`; nodes with empty content are excluded.</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-601"><a href="#RoadNetworkGrid.iter_cell_list_contents-601"><span class="linenos">601</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-602"><a href="#RoadNetworkGrid.iter_cell_list_contents-602"><span class="linenos">602</span></a>        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-603"><a href="#RoadNetworkGrid.iter_cell_list_contents-603"><span class="linenos">603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">road_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-604"><a href="#RoadNetworkGrid.iter_cell_list_contents-604"><span class="linenos">604</span></a>            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">filterfalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_cell_empty</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">)</span>
</span><span id="RoadNetworkGrid.iter_cell_list_contents-605"><a href="#RoadNetworkGrid.iter_cell_list_contents-605"><span class="linenos">605</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns an iterator of the agents contained in the nodes identified
in <code>cell_list</code>; nodes with empty content are excluded.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="core.html#Space">core.Space</a></dt>
                                <dd id="RoadNetworkGrid.random" class="variable"><a href="core.html#Space.random">random</a></dd>

            </div>
            <div><dt><a href="view.html#Viewable">view.Viewable</a></dt>
                                <dd id="RoadNetworkGrid.add_view" class="function"><a href="view.html#Viewable.add_view">add_view</a></dd>
                <dd id="RoadNetworkGrid.get_views" class="function"><a href="view.html#Viewable.get_views">get_views</a></dd>
                <dd id="RoadNetworkGrid.update_views" class="function"><a href="view.html#Viewable.update_views">update_views</a></dd>
                <dd id="RoadNetworkGrid.clear_views" class="function"><a href="view.html#Viewable.clear_views">clear_views</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>